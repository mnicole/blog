<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Thoughts on Things]]></title><description><![CDATA[Thoughts on Things]]></description><link>https://michelelarson.com/blog</link><generator>RSS for Node</generator><lastBuildDate>Wed, 30 Jan 2019 05:19:08 GMT</lastBuildDate><item><title><![CDATA[Thoughts on Security Defenses (Defense of the Dark Arts)]]></title><description><![CDATA[This week focuses on life as a malware researcher and covers how the attack gets into the system, how it typically functions, and how we can…]]></description><link>https://michelelarson.com/blog/security-defenses/</link><guid isPermaLink="false">https://michelelarson.com/blog/security-defenses/</guid><pubDate>Sat, 26 Jan 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;This week focuses on life as a malware researcher and covers how the attack gets into the system, how it typically functions, and how we can defend against it.&lt;/p&gt;
&lt;h4&gt;Spreading malware&lt;/h4&gt;
&lt;h5&gt;First contact - Possible Sources&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;Email, Instant Messaging&lt;/li&gt;
&lt;li&gt;Malvertising - contaminated ads&lt;/li&gt;
&lt;li&gt;Poisoned search results - Trow up sites based on google trends that would show up high in search results that people would then click on&lt;/li&gt;
&lt;li&gt;Watering hole - go to the place where people mostly go and poison one place&lt;/li&gt;
&lt;li&gt;Physical access - such as USB drives&lt;/li&gt;
&lt;/ul&gt;
&lt;h5&gt;Local Execution&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;Autorun - Windows will automatically run software&lt;/li&gt;
&lt;li&gt;Exploitation of a document or file - PDF, plugin, browser&lt;/li&gt;
&lt;li&gt;Reverse psychology/social engineering - “don’t click here” “click to claim your prize”&lt;/li&gt;
&lt;/ul&gt;
&lt;h5&gt;Establish Presence&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;Tries to blend in and hide (change filenames or datetime stamp, sign files)&lt;/li&gt;
&lt;li&gt;Tries to appear legitimate&lt;/li&gt;
&lt;li&gt;Persists (system startup, application start up, scheduled tasks, etc)&lt;/li&gt;
&lt;/ul&gt;
&lt;h5&gt;Attack&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;Harvest information&lt;/li&gt;
&lt;li&gt;Phone home - use web, email, FTP to send data&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Defenses&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;User education&lt;/li&gt;
&lt;li&gt;Block computer ports&lt;/li&gt;
&lt;li&gt;Anti-virus/malware&lt;/li&gt;
&lt;li&gt;Network Firewall/Inreusion Prevention&lt;/li&gt;
&lt;li&gt;Message/Network/Web Reputation&lt;/li&gt;
&lt;li&gt;Host Firewall&lt;/li&gt;
&lt;li&gt;Host IPS&lt;/li&gt;
&lt;li&gt;Access control&lt;/li&gt;
&lt;/ul&gt;
&lt;h5&gt;Anti-malware features&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;File Scanning&lt;/li&gt;
&lt;li&gt;Registry and Cookies&lt;/li&gt;
&lt;li&gt;Cloud scanning&lt;/li&gt;
&lt;li&gt;Memory scanning&lt;/li&gt;
&lt;li&gt;Scripts&lt;/li&gt;
&lt;li&gt;Heuristics&lt;/li&gt;
&lt;li&gt;Decomposition&lt;/li&gt;
&lt;li&gt;Configuration: Exclusions, sensitivity, reporting&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Yara&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;language that lets you search for patterns in your scans&lt;/li&gt;
&lt;li&gt;strings - &lt;code class=&quot;language-text&quot;&gt;&amp;quot;in quotes&amp;quot;&lt;/code&gt; params: &lt;code class=&quot;language-text&quot;&gt;nocase&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;wide&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;wide ascii&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;fullword&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Byte patterns (hex strings) &lt;code class=&quot;language-text&quot;&gt;{}&lt;/code&gt; params: &lt;code class=&quot;language-text&quot;&gt;?&lt;/code&gt; &lt;code class=&quot;language-text&quot;&gt;??&lt;/code&gt; are wildcards &lt;code class=&quot;language-text&quot;&gt;{E2 34 ?? C8 A? FB}&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;conditions are boolean operators, arithmetic, and bitwise &lt;code class=&quot;language-text&quot;&gt;($a == 6 or $b)&lt;/code&gt; &lt;code class=&quot;language-text&quot;&gt;#a == 6 and #b &amp;gt; 10&lt;/code&gt; &lt;code class=&quot;language-text&quot;&gt;$a at 100 and $b at 200&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;example:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;rule myRule {
    strings:
        $a = &amp;quot;win.exe&amp;quot;
        $b = badfile1.exe
        $c = badfile2.exe
    condition:
        $a and ($b or $c)
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/blog/static/d6c8310b7e03f48b679c26b2f70516c0/26c84/yara.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 49.33554817275748%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABS0lEQVQoz32S666CQAyE8YoX5CKKKIpX1BA1vP/L9fhNssYTjT8mu9m20+lsvaZp7Hg82ul0srqu7fF42G63s8vlYtfr1RaLhY3HYxuNRjo9z/uN7XYrgvl8bv1+37rdrgK9Xk9kWZYptlwubb1e22q1siRJ9N7pdD4JB4OBRVGkBE6XxPv5fJZySCCrqkrg7XA4GGImk8l/wjCMXqrewYhYgXpIhsOh8lqtlrXb7dcUH7V0CIJAcIkAgs1mI2W3201q8jwXmII4wCam4S6Pi2dB/vRqv98r6AjpTvF0OhUxHmJLURRqkqaplWUpn8lDkAh935fp+BXHschQSleIKMQvfKRwNpupObm8kQMpjeHx8CoMQ/0coBMkWEEhKjjx0t0hY4Kva8PPfgui8H6/azc52Ve3Wu6DvhIy8vtnOFCAZ24URkU5U/xa7D+P7+oXt1IKBgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;&lt;/span&gt;
    &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Yara&quot;
        title=&quot;&quot;
        src=&quot;/blog/static/d6c8310b7e03f48b679c26b2f70516c0/fb8a0/yara.png&quot;
        srcset=&quot;/blog/static/d6c8310b7e03f48b679c26b2f70516c0/1a291/yara.png 148w,
/blog/static/d6c8310b7e03f48b679c26b2f70516c0/2bc4a/yara.png 295w,
/blog/static/d6c8310b7e03f48b679c26b2f70516c0/fb8a0/yara.png 590w,
/blog/static/d6c8310b7e03f48b679c26b2f70516c0/26c84/yara.png 602w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/span&gt;
  &lt;/a&gt;&lt;/p&gt;
&lt;h4&gt;Automated Analysis&lt;/h4&gt;
&lt;h5&gt;Cuckoo&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;Automated analysis - You tell it what VMs to run and when you upload a sample, it will run it on the VMs and report the results.&lt;/li&gt;
&lt;li&gt;The host controller of &lt;a href=&quot;http://docs.cuckoosandbox.org/en/latest/introduction/what/&quot;&gt;Cuckoo&lt;/a&gt; tells each VM how to run the file. It will create the process, inject its DLL (randomly named to avoid detection) into the process, and then trace the Win32 API calls which then it can report back.&lt;/li&gt;
&lt;li&gt;It also reports files being created, deleted, and downloaded by the malware; memory dumps of the malware processes; network traffic trace; screenshots of Windows desktop; full memory dumps of the machines&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4&gt;Lab&lt;/h4&gt;
&lt;p&gt;We are given some sample files to analyze using Cuckoo. I chose to write about the last file. First I use the command line to run Cuckoo on the file:&lt;/p&gt;
&lt;p&gt;&lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/blog/static/b0c184f694330c10af6d35ceadf9c996/5d9c9/cuckoo.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 96.9230769230769%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsSAAALEgHS3X78AAACjklEQVQ4y3WU13KaQQyF95rQe+8dfprpJBkSxwETD2Mnef9XkffTWAw3vtDsImmPjo7E7za7gzSbTel2e2qdblcq1apEojGJekul0nqPRKL+NIvJl3BEYrG4nuGIWVTc6XyRlgccj8eyWCxkOp1ogVQqJZl0WorFomQyGSmXy5LNZiX7cc/n81KpVCSXy+m9VCpJMpkU9/h0kopPIKnqmWG1Wk2TW62WGgXwcdbrdS2G4dPCvkjaF+d019c3z2oqw9FINpuNLJdLNXyr1Urm87kEQSCz2UyOx6MMh0P93e/39U5n5FIoHo+LOz//UScPYQBD2BYKBWk0GsoCo3XY2kmuxbnTsgJeXq5aHaOKAQAIMI/NV/6QBs2Io58VgwinO3mGk8lEaQPa6/VUP4L3gPgYCkwSiYTqZcPixI+53x7w4WGheq3X65tm7XZbdUKOTqdzmzZGazYI/EyXYnSoDIeDgT4a+BNGVGJ6POBuLcKMh1G/i9wxYhQgH7bu+vZPAs8CsJGfNCcSAEz7TBKfse36xac4vzFi+LgD6o4/f2kCbdqE0QwmsLpfXuK0io8Y7MmjbXK05cP3401wmxytftYyPmsZ7Yhx4tMpv/79ry1aq7QIY3aLthnSvRwW426aW0f612MPg2CsYEzaVghDht1up/8gzu12e9uE/X6v2gGCTMbcnS8vOmWYAYbw3KnMAx7DCuOfATsbFkAMg8JIFQqFxP14fJKaF7vhE+8f2kfCwAHBiAHC3WRBZxvSrWWY8PlioUkCGMD7tcCMOYXIJc++SpBwh6/fFMg+EFQGCCasgQ0Ds48HYGhMLuC85Y0CzucLDfKQKgBBnSDrBAvWAdFt5+y/i4ZoxwqFw2G1dwCxE6FPJEQ+AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;&lt;/span&gt;
    &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Running Cuckoo&quot;
        title=&quot;&quot;
        src=&quot;/blog/static/b0c184f694330c10af6d35ceadf9c996/fb8a0/cuckoo.png&quot;
        srcset=&quot;/blog/static/b0c184f694330c10af6d35ceadf9c996/1a291/cuckoo.png 148w,
/blog/static/b0c184f694330c10af6d35ceadf9c996/2bc4a/cuckoo.png 295w,
/blog/static/b0c184f694330c10af6d35ceadf9c996/fb8a0/cuckoo.png 590w,
/blog/static/b0c184f694330c10af6d35ceadf9c996/5d9c9/cuckoo.png 650w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/span&gt;
  &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Cuckoo outputs a series of csv files in the /logs folder that detail everything the malware did. I start here reading the logs since I see the processes happened from “bad” (which is what it’s configured to run on):&lt;/p&gt;
&lt;p&gt;&lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/blog/static/f521780945e3f6e10bae330aa5f563de/870c1/doc1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 69.98031496062993%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsSAAALEgHS3X78AAAB/0lEQVQ4y51SO2/UQBD2vwfE8VRCBIgCikABERFFaAKIDlHRpkvO3rXXj10/7nzoTvqYb7w5XASKFKO1Z3e+x8wkX86/4vTjKd6ffMKbtydYPH2JRwevsHjyQuI57iwOcO/hMzkPcffBYfw/0pO5+4+P8Pr4A76df8evz2dIjn84vPtZ4dI2WA09vPdYrVZYr9fYbDbYbrf6PY4j+mGQNyuM6xG73Q5d16HvB3n3G00IqCSSiyuLi0uLqvbwwcO5Qr5rNE2D5fIKxmTI8xx1U8NYg7IsJb9EJnnGMk2VaBTS0uVIijyDyw28AFCdc06Kp+9UHmdZqrnGN8gLAa6rPZi1Vkis3Hl0fSdkDgkvjDGq6GbADMWNgEYBGam8qaoKZVUiMbcBzGYKpdZL7waxzXYl1pKJgF4v2COCB+knC0noJOf3gLWCqELpLS1THQHVciGoVBVCi7ZrtSC0rUywRVEUyspcKzlaCmFywTuSa38bbsagQhImGCy4BmwVsMNENk2dOSrZA0qU7JuA8uR7ukhog2sRxC6DRZPlEC2bv0BiSS1Li67reE+1BIxDMXEo0x6WamHqYSorwx4W/1ubOG0OUQFtbmMiKuRQ5HKuUIciBGxBExecw6BC1hK8EiLGTOHt1ibTHYxD45SVbW65jIAzy+5fi51bPQmmeyi1fwDRbAfI79mkeAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;&lt;/span&gt;
    &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Log 1&quot;
        title=&quot;&quot;
        src=&quot;/blog/static/f521780945e3f6e10bae330aa5f563de/fb8a0/doc1.png&quot;
        srcset=&quot;/blog/static/f521780945e3f6e10bae330aa5f563de/1a291/doc1.png 148w,
/blog/static/f521780945e3f6e10bae330aa5f563de/2bc4a/doc1.png 295w,
/blog/static/f521780945e3f6e10bae330aa5f563de/fb8a0/doc1.png 590w,
/blog/static/f521780945e3f6e10bae330aa5f563de/526de/doc1.png 885w,
/blog/static/f521780945e3f6e10bae330aa5f563de/870c1/doc1.png 1016w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/span&gt;
  &lt;/a&gt;
&lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/blog/static/4dd2151ced827126ce79414658b99484/d5f08/doc2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 66.69902912621359%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACBklEQVQ4y4WSW2vUUBSF8///gLZqpXhD8EnECwNSC/pQ6IOF0okzFTQzk9tJMpPbJHNb7rWTE6UUDGzOScj+zlp7Hefi8gqfv3zDu/cjfBqd4fWbt3hwfIpHT1/i4eNnOHryXPdHdn/yAseyDiXvJ6ev8GF0jouzczg/b2+RmRCJiRFGMbLlEmVZIssyFEWB1WqFpVRVVvpeFCXqupZao2la2Ge73SGXf5zv1zf46kb45ceIogBxYmAEPpt7yAnMBSiHVFUp4KUeVFUVqrrqwOu1wLbY7XbYbjYEuvh4FWLihYjjsAcaAc6QZimCMMB8MVfoWpoJoQOq5VqKKgts2xbOD3eMVRIiFdDC9xGLOmMSeDNP7RNOVfz5cDgMxcfuCVOFAnbG47GoiLRx4S96oBHgb7Gbq8okSdQmVeXyTecqh3HlO0H7/V4ObeBMJhOBdDb9wIfpLdMm59eF0gXFJiriel9RpTOdTkUh5xcrMBFgJHt+I8yXMYSyj6JQlfIwHtA0jQRSo5FRWKAqdMWyHwTSEN2x7HWW01QOiNQuA6H1kin3xaC6Ge67UDhDwth4NxQq5HeGoor0/v1N2c7UznDDa+O6HTAeQjFqn3s2E8YmVabXpFS4nZmtAUiF3WwShZgeyFDYSEssXmRrs2n/Awz/CcXOkKoHW0WuEM4ul+TZeC9QZvgH6lDQFIQ8fBsAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;&lt;/span&gt;
    &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Log 2&quot;
        title=&quot;&quot;
        src=&quot;/blog/static/4dd2151ced827126ce79414658b99484/fb8a0/doc2.png&quot;
        srcset=&quot;/blog/static/4dd2151ced827126ce79414658b99484/1a291/doc2.png 148w,
/blog/static/4dd2151ced827126ce79414658b99484/2bc4a/doc2.png 295w,
/blog/static/4dd2151ced827126ce79414658b99484/fb8a0/doc2.png 590w,
/blog/static/4dd2151ced827126ce79414658b99484/526de/doc2.png 885w,
/blog/static/4dd2151ced827126ce79414658b99484/d5f08/doc2.png 1030w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/span&gt;
  &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;It looks like the malware tries to find out information about a &lt;code class=&quot;language-text&quot;&gt;prints.exe&lt;/code&gt; file (NtQueryDirectory) as well open the file and another file &lt;code class=&quot;language-text&quot;&gt;ntshruis2.dll&lt;/code&gt; from &lt;code class=&quot;language-text&quot;&gt;C:\Users\Admin\AppData\Local\Temp\&lt;/code&gt;. It also creates a registry key in the Session Manager and tries to open various registry keys. It later successfully creates the &lt;code class=&quot;language-text&quot;&gt;prints.exe&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;ntshruis2.dll&lt;/code&gt; files, as well as a &lt;code class=&quot;language-text&quot;&gt;Deleteme.bat&lt;/code&gt; file in &lt;code class=&quot;language-text&quot;&gt;C:\Users\Admin\AppData\Local\Temp\&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Looking at the strings, I also see it looking for a user &lt;code class=&quot;language-text&quot;&gt;SOFTWARE\Borland\Delphi\RTL&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Knowing about the files it creates and where they are stored, I open up the Temp directory before running the malware:&lt;/p&gt;
&lt;p&gt;&lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/blog/static/e771ebf34808e495ce8e831561ceeaa3/b7a32/created.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 34.18803418803419%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAABoklEQVQoz2VQPU8VQRTd/4IR/ACMhGdhbGxorPgFFlT0FBb22hliYUlrYmnkKwg8Aw+I8hKIhcbney8+WHdnv2Zndmbf7izHO+NH4yQn99yce8+5GW/tzQZWnjzFwqNF3Gk9wOT0PK7fnsPUzDyh9R+u3ZrDxM27uDF7D637D/F4aRmrL1/h9eoLrD1/Bq/bj3HwqYv13WOsv+9gq32Ct9sfHN/cO8K7nUPsHJyifXLmsLH/kWaPsNfpUn+O/eNz2v+M9ukXbHbO4A1/BAiSAhHXuGQ5wrRAIsYIqKZU//ZW9yOBVFaut8i1QZgpRDlpTODrIIT3vd9HmsSwT6sUgT+CFML1V435h0IKxHGMPOcoCgkhctTVGKau0ZjfiHgB79L3cTG6gNYaUmkM+gP0vvUQhgxSFjDGoK4NGQiEjCHLMuISjHiSpKjI0O3SLJcaXhIzSs3dkiJhSIY2oCxLVOPKGTYEzjP4FG6v5GQa/AxciDENaRycPBh9i9cbjsCC0AmlVkiiiAZyNE3z57raVaWUC7aXWG7NrGbnylK7Y4JU4RfBwufRhGXrcwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;&lt;/span&gt;
    &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Created files&quot;
        title=&quot;&quot;
        src=&quot;/blog/static/e771ebf34808e495ce8e831561ceeaa3/fb8a0/created.png&quot;
        srcset=&quot;/blog/static/e771ebf34808e495ce8e831561ceeaa3/1a291/created.png 148w,
/blog/static/e771ebf34808e495ce8e831561ceeaa3/2bc4a/created.png 295w,
/blog/static/e771ebf34808e495ce8e831561ceeaa3/fb8a0/created.png 590w,
/blog/static/e771ebf34808e495ce8e831561ceeaa3/b7a32/created.png 819w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/span&gt;
  &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;I also see a file called &lt;code class=&quot;language-text&quot;&gt;qinput.png&lt;/code&gt; which I translate using my phone. It looks like a login screen:&lt;/p&gt;
&lt;p&gt;&lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/blog/static/4ff17cc80b1f9a314475eb16738ab8bc/e3ca9/created2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 70.68004459308807%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsSAAALEgHS3X78AAACYElEQVQ4y42Sy27TQBSG8zDseQGegSULWHSHCgKhUipxkVAEqFWXILJCSBULtl0gSpUipaoUpYhWapIW4iap6zh27MSOx/fcf844CXFSFiw+zZkzM7+Pz38SmcMCTgQZuaKEg7yE/YKMdEHHTr6JnRMdu8UWdgsz0mcG0qdj9ijeFywclg3k8wL2tr8iUa0b0FgHqhmMaQdomD5Uw0OThWjZnYimzePZPp7XrBBmCByV6kiYThdO0IftE8EMRvu214uwvP4c/CyORXf87giVSwUJXsU0GccJBgh7QNgdIgj78GPYC/fbbhdeFxAuqEKNfpFXxA+YP77ghgMIqoXtbJF6WUNGdHEgecjKPrI1D3V640zeWD4X7EWCv6skWK1pcDujOUFendh08CVXwPd8BUcyww/RwE/JxLFsQbWCWZW8NVShT4K/uOC5qFwR5C0w3Q4000KtoaPRaqOmapApVptmdDa9z+KCFRmJ8uVVQf51zfKgGAzUQoSDUbR2CDqK3GbcIG7KxDj+y6ULMqUs/ltQaXuo6DZUFkBhPmTTofHyKe9Cp9xfI/3/FvQhaIywcUYGHYs6SooJod6aE2SLgtxqJxyBz2N8FNhk3uwpZFR87hbHhto6FpTUFjV0SIk+ucur60Ywb0a0X8zFYovUuEapSqZ8y+SoTyOUzm1IWg+KPYRqA5oLNBxA90BjQjk2jGKeX6RBGFRhkUYrce36Ddy+n8TNW6u4s/wKSyvrePAyhbXNLTzd/Ii1Nyk8Wv+MlY1PePI6hdWNLTxb/4DHyfe4+/wtlol7L95F69LDJP4A/x0HA7PL3voAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;&lt;/span&gt;
    &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Created image file qinput.png&quot;
        title=&quot;&quot;
        src=&quot;/blog/static/4ff17cc80b1f9a314475eb16738ab8bc/fb8a0/created2.png&quot;
        srcset=&quot;/blog/static/4ff17cc80b1f9a314475eb16738ab8bc/1a291/created2.png 148w,
/blog/static/4ff17cc80b1f9a314475eb16738ab8bc/2bc4a/created2.png 295w,
/blog/static/4ff17cc80b1f9a314475eb16738ab8bc/fb8a0/created2.png 590w,
/blog/static/4ff17cc80b1f9a314475eb16738ab8bc/526de/created2.png 885w,
/blog/static/4ff17cc80b1f9a314475eb16738ab8bc/e3ca9/created2.png 897w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/span&gt;
  &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Translation:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;re-register&quot;&gt;&lt;pre class=&quot;language-re-register&quot;&gt;&lt;code class=&quot;language-re-register&quot;&gt;Dear User:
Since your network is unstable, please login:
[input]
Password:
[input]
[Login] [Cancellation]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Looking at the &lt;code class=&quot;language-text&quot;&gt;Deleteme.bat&lt;/code&gt; file, it seems to do exactly what it’s named, delete the source of the malware:&lt;/p&gt;
&lt;p&gt;&lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/blog/static/fee8c8abdd33d05bfa0c9ab9554ba1a9/cf471/created3.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 26.773888363292336%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsSAAALEgHS3X78AAABTklEQVQY03WP3StDARyGzz9GQpqvaMTccOOjSG4myYU/QPKRK3GhcIPSppaxDdvZztlpOzqO2c5m5+xYRORurbb1OLiUXz09N+/71k/YWlrm4NjH2Pg0k3MLeJdXGJ+dx+0ZpdXVS0//EH2DI/S6h2np6KaptZPm9i6a2hw7uAY8THgXWd3YZGFmCuH2LoPxoKCmUiSSOnJKQ1Vvyeg6ecPALD5SLj/x8vJMybbRswUyRpFMzsG0ub+Ik17fJ719wtH6LkIsIfGNKCcdy86oguRwE4sRjkSQZJnzYBD/mZ9Tnw9/IMBVTCR8EyXkZEL+AJc7h1zvH7O3toWQz+bIF4oUTQvTsnl9e+f94xOrZJNWVSyr9ONoNIooiiTicRKShKIoaJqGdq+jGVkKTyWC4RAC/1y1WnVeLVOpVGg0Gj/UajXqtfqv6/U/Hcs0+QLcX0QEn39BogAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;&lt;/span&gt;
    &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Deleteme.bat&quot;
        title=&quot;&quot;
        src=&quot;/blog/static/fee8c8abdd33d05bfa0c9ab9554ba1a9/fb8a0/created3.png&quot;
        srcset=&quot;/blog/static/fee8c8abdd33d05bfa0c9ab9554ba1a9/1a291/created3.png 148w,
/blog/static/fee8c8abdd33d05bfa0c9ab9554ba1a9/2bc4a/created3.png 295w,
/blog/static/fee8c8abdd33d05bfa0c9ab9554ba1a9/fb8a0/created3.png 590w,
/blog/static/fee8c8abdd33d05bfa0c9ab9554ba1a9/526de/created3.png 885w,
/blog/static/fee8c8abdd33d05bfa0c9ab9554ba1a9/cf471/created3.png 1057w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/span&gt;
  &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Finally, the malware tries to download one file, &lt;code class=&quot;language-text&quot;&gt;TJ.asp&lt;/code&gt;:
&lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/blog/static/23ae0c646c8890afe7da4d3d5b50c14c/32413/network.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 583px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 56.089193825042884%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAACDklEQVQoz42SS2sTYRSGJzEJuZPQ3Cb3+3UumSRNJiYL9xJsaiRpa0GCqJWKRdA/4M6ley12odlYkFYdNzUQaSlqwYJ/QH/I63wHKy5a2sXLOXNmvvc853zDffpyBE2bQvs4xcH+MWafv0Gb/sDrvWN8OPqF7dlPvNrZh/b1Nybad0zeHWDyZg8vXu5ic/M9trY0bL+dYXfnUPc4BPf02XMsLCxiOFzBYDBCr9dHf7CE3mAZV/tD9K6PsDq+i8HyLTQvX4Egz0MQaqhUFBLLlWqLJEkNcPfWN5BKJiCIArLZLJLJJGRJ1GtxZDNp8MEA/L45uF0OcBx3vh4+eoJ0KgVZllEsFlEqlfTOFUj6cy6XQ0Zvks/nkU6n4fcHYDQaYTAYdBlPFbcyXkM0wiOeSCAejyMcDlP0eDxwu90U7XY7mVyI8M6Dx1Bb82i1VNTrdSJlSunUoVBIp/LD6XTCarXCZDKdb3jz9jr4UIAMYrEYGUSj0X+kLLJ6JBIBz/MIBoP0jc/nowlYZDWH4++Or91YhemSEV6vFzabjV6w3OVyERGrmc1mIrzQyOO1DdSUKrrdLtrtNlRVRafTQbVaJTJGzm6fkfy/xzN32lscoVIuQdYNBEFArVZDs9kkQ5YrioJGo4FyuUzKZDLUhE1w+g7H9xGLRiCKIv0uhUKBDkqSRLdrsVhIJ+Of5GeN/AdK40dTGlNvXQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;&lt;/span&gt;
    &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Tries to download a file&quot;
        title=&quot;&quot;
        src=&quot;/blog/static/23ae0c646c8890afe7da4d3d5b50c14c/32413/network.png&quot;
        srcset=&quot;/blog/static/23ae0c646c8890afe7da4d3d5b50c14c/a734f/network.png 148w,
/blog/static/23ae0c646c8890afe7da4d3d5b50c14c/5c6ba/network.png 295w,
/blog/static/23ae0c646c8890afe7da4d3d5b50c14c/32413/network.png 583w&quot;
        sizes=&quot;(max-width: 583px) 100vw, 583px&quot;
      /&gt;
  &lt;/span&gt;
  &lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Thoughts on Forensics (Defense of the Dark Arts)]]></title><description><![CDATA[This week focuses on how to investigating security incidents. You should be aware of the best way to investigate it while being careful to…]]></description><link>https://michelelarson.com/blog/security-forensics/</link><guid isPermaLink="false">https://michelelarson.com/blog/security-forensics/</guid><pubDate>Fri, 18 Jan 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;This week focuses on how to investigating security incidents. You should be aware of the best way to investigate it while being careful to preserve evidence.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Side note - the lecturer talks about the book, &lt;a href=&quot;https://www.goodreads.com/book/show/18154.The_Cuckoo_s_Egg&quot;&gt;The Cuckoo’s Egg&lt;/a&gt;. I read it last year and loved it!&lt;/strong&gt;&lt;/p&gt;
&lt;h3&gt;Types of cases you may investigate&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Fraud&lt;/li&gt;
&lt;li&gt;Intellectual Property&lt;/li&gt;
&lt;li&gt;Hacker Intrusions/Data Breaches&lt;/li&gt;
&lt;li&gt;Inappropriate use of Internet&lt;/li&gt;
&lt;li&gt;Child Exploitation&lt;/li&gt;
&lt;li&gt;eDiscovery supporting Civil or Criminal Litigation&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Stages of Investigation&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;Evidence acquisition&lt;/li&gt;
&lt;li&gt;Investigation and Analysis&lt;/li&gt;
&lt;li&gt;Reporting results&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;Forensics&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Includes: Identifying, preserving, analyzing evidence and presenting results.&lt;/li&gt;
&lt;li&gt;Could find evidence in network, operating system, databases and applications, peripherals, removable media, human testimony&lt;/li&gt;
&lt;li&gt;To keep in mind: It’s not up to you to judge guilt. It’s up to you to show what happened. If you think someone is guilty, you look for information to prove your opinion, so it can make you biased while investigating.&lt;/li&gt;
&lt;li&gt;Need to describe results in a way that a judge will understand. Something the lecturer does is ask questions like an attorney to see if there’s anything a judge might ask that they can clarify now.&lt;/li&gt;
&lt;li&gt;Always check times and keep records of times.&lt;/li&gt;
&lt;li&gt;Any time you do anything, it affects the memory and could erase something.&lt;/li&gt;
&lt;li&gt;Locard’s Exchange Principle - when two things interact, there is always transference of material. Thoroughly document anything you do on a live system.&lt;/li&gt;
&lt;li&gt;Triage - There may be different ways to do something. You should check multiple ways to make sure you can come to the same conclusion.&lt;/li&gt;
&lt;li&gt;You can’t log into accounts even if you come across the username and password. You need permission from a judge. It has to be relevant to the case.&lt;/li&gt;
&lt;li&gt;Harddrives are giant and there may be a time limit. You also might get additional harddrives, portable harddrives, cell phones, etc. It takes time to process the data.&lt;/li&gt;
&lt;li&gt;Whitelisting is good to match checksums and verify files are ok and you don’t have to waste time investigating them. The person processing the harddrive will do a checksum of the entire harddrive. The first thing you should do is check that to make sure the evidence wasn’t tampered with.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Incident Response Process&lt;/h3&gt;
&lt;ol start=&quot;0&quot;&gt;
&lt;li&gt;Incident Response Team Preparation&lt;/li&gt;
&lt;li&gt;Incident Detection&lt;/li&gt;
&lt;li&gt;Initial Response&lt;/li&gt;
&lt;li&gt;Formulate Response Strategy&lt;/li&gt;
&lt;li&gt;Investigate the Incident
4a. Data Collection
4b. Forensic Analysis
4c. Perform Non-Forensic Investigation&lt;/li&gt;
&lt;li&gt;Document Findings
5a. Administrative Action&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;APT Case Evidence&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Reconnaissance: Firewall/IPS logs&lt;/li&gt;
&lt;li&gt;Delivery - Email Gateways logs, proxy logs, internet history, Java-IDX files&lt;/li&gt;
&lt;li&gt;Exploitation - Windows Event logs, crash dump files&lt;/li&gt;
&lt;li&gt;Installation - $MFT, memory dump registry, prefetch-files&lt;/li&gt;
&lt;li&gt;Command and Control - Memory dump, firewall logs, proxy logs, netflow&lt;/li&gt;
&lt;li&gt;Actions on Objectives - $MFT, memory dump registry, prefetch files, netflow, remote tools&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;em&gt;Initial Response - Shutting off the machine can destroy evidence, but you should pull network cable or block port (attacker may be on network still, even watching you!)&lt;/em&gt;&lt;/p&gt;
&lt;h4&gt;Order of Volatility - RFC 3227&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;Gather evidence in specific order, capturing the most volatile things first&lt;/li&gt;
&lt;li&gt;System memory&lt;/li&gt;
&lt;li&gt;Temporary file systems&lt;/li&gt;
&lt;li&gt;Process Table and Network Connections&lt;/li&gt;
&lt;li&gt;Network Routing Information and ARP cache&lt;/li&gt;
&lt;li&gt;Forensices Acquisition of Disks&lt;/li&gt;
&lt;li&gt;Remote Logging and monitoring data&lt;/li&gt;
&lt;li&gt;Physical config and network topology&lt;/li&gt;
&lt;li&gt;Backups&lt;/li&gt;
&lt;li&gt;Non volatile data (Time/Data stamps, event logs, web/application logs, registry)&lt;/li&gt;
&lt;li&gt;Relevant logical files (Unknown executables, attacker tools, any other files related to incident)&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;FTK Imager&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;Easy free tool, to dump memory, but leaves an imprint in memory so it’s better to do with commands.&lt;/li&gt;
&lt;li&gt;Note - Never install forensics tools on a suspect’s computer, because you’re influencing!&lt;/li&gt;
&lt;li&gt;Capture memory - don’t store it on desktop. usually will want to store on a shared network. Naming - operation + serial number or date + .mem. You can decide to include pagefile&lt;/li&gt;
&lt;li&gt;Add evidence item - you can copy external sources&lt;/li&gt;
&lt;li&gt;Take a look - find root -&gt; $MFT master file table. You can export it from this tool&lt;/li&gt;
&lt;li&gt;Create disk image, pick encase (E01) as format or raw (DD)&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Physical memory - system memory (RAM) - short term memory&lt;/h4&gt;
&lt;p&gt;You can get…&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;All running processes at time of snapshot&lt;/li&gt;
&lt;li&gt;All loaded modules and DLL’s including malware&lt;/li&gt;
&lt;li&gt;Running device drivers, including rootkits&lt;/li&gt;
&lt;li&gt;Open files for each process, including path to file on disk&lt;/li&gt;
&lt;li&gt;Open registry keys for each process&lt;/li&gt;
&lt;li&gt;Open network sockets including IP address&lt;/li&gt;
&lt;li&gt;Decrypted versions of data&lt;/li&gt;
&lt;li&gt;Contents of windows&lt;/li&gt;
&lt;li&gt;Keystrokes&lt;/li&gt;
&lt;li&gt;Email attachments, file transfers&lt;/li&gt;
&lt;li&gt;Cryptographic key material&lt;/li&gt;
&lt;li&gt;WEP and WPA wireless keys&lt;/li&gt;
&lt;li&gt;Usernames/passwords&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Analyzing Memory Dumps&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;Look for a printable string&lt;/li&gt;
&lt;li&gt;Reconstruct internal data structures&lt;/li&gt;
&lt;li&gt;Search for static signatures of kernal data structures&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Volatility&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;Advanced memory forensics framework&lt;/li&gt;
&lt;li&gt;Plugins - malfind, csrpslist, orphan threads, PSList, PSScan, svcscan, ldrmodules, impscan, apihooks, idt, gdt, callbacks, driverirp, psxview, ssdt&lt;em&gt;ex, ssdt&lt;/em&gt;by_threads&lt;/li&gt;
&lt;li&gt;Yara - Malware plugins for Volatility&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;volatility.exe -h    // shows options
volatility.exe -f nameofmemorydump pluginname
volatility.exe -f nameofmemorydump --profile=Win7SPOx86 pluginname&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;em&gt;Plugins:&lt;/em&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;imageinfo&lt;/code&gt; - tells us windows operating systems. image date and time - when you took the memory dump&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;psscan&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;dlllist -p &amp;lt;processid&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;netscan&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Deskscan&lt;/code&gt; - &lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Getsids&lt;/code&gt; - see which user rights the malware was running&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Windows Registry&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;regedit&lt;/code&gt; in run window
&lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/blog/static/87791a29882b11a34ebbf788ee275572/4f5b3/registry.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 291px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 79.03780068728523%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsSAAALEgHS3X78AAADEUlEQVQ4y52S20sUYRjG518oqMD7LrsqqPAmb0KILjpQKeJFYGrioQgFS/F0oWWJZpIgnaBCkP6CrrU0a13X3dnjzOwcdg47M7utGrqHp/ebXRUv8qIPHr73m8Pve94DV1P/EFeaulHfOYC2Jy/Q+ngcLb3P0NQzhobOQdR3DOJSXReqqu/gxPmbOH7uOo6d3dO1isrn4ySuprkXp+8242pjOxraenD73qOKulFbdx+1t1pw5nIjuKpqcCcvHK1TF8HdaO3H6OxHTL5ZwNTbBUzMzePp608YefkeQ1MfMDD5Dt2js+gamcGD4Rl0Db/y1DE4jc6hctw5NL0vrn1gGtF4CnwsBUl1sRYQkJBdRBMG1oMiRCULIWkjHNPomY5QRIGkZJCkbzd4GXHBhOUWYdq7pDwB+yegW1nEJQOBkI6EqEGSDYgkFguSDkVLl5Uq72rKhma4kDULsmp5/+tmBikS1zc2AwdAWLHwed6HaEyAz+fDr5+rWCUtLS0ik83i6FXa37n2vudeWCjksbX9B9l0AL9dEZKkIhKNQjcMOI4LXddhUKxpKTi27e3snMlkyqhSCcVikRyOz1UeFJEvApvpZWy6PDRKTxJFpOlny7IgCAIURYEoSQSjUiQE75JcLncYuOQXvAMD7uwCW/YPAoaRlHXwPA+TYMxJOMxjbX0DwVAYadOAqqlY8wdgpu0DIIn78nWFncoOCwR0/NjKJghERZdl2I4Dm6WoqgRJkds0TLrANE1IyfJ7BmLLc/h9PYQSBZ7DPJCzlpBzgpSiSq7ClLoOlcAsTVlWvH1leQVyUkQkEsO3xUWCugfABN1WrACZw2234tB0kEwmvY+ZGxYzIKtZoVDAzs7OvvL5/AEwQB/tAXfzrCkr5DAEWTHIQZhSp+ZQIyKRKOLxhAf71/KAkqodArKmbGWj5EYnQJwaYtLYOIjHogjyEWpUhOqpeI1il/hpZhVilBtLTVG0PWAJBRqb7QxPQBqXNE1+SqM5y3qFN2hEVG/2LLh0ZrPJGsRq6rjuAVCuAA9P/P8txvkL/uNLqQsdAo4AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;&lt;/span&gt;
    &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Registry Editor&quot;
        title=&quot;&quot;
        src=&quot;/blog/static/87791a29882b11a34ebbf788ee275572/4f5b3/registry.png&quot;
        srcset=&quot;/blog/static/87791a29882b11a34ebbf788ee275572/cde50/registry.png 148w,
/blog/static/87791a29882b11a34ebbf788ee275572/4f5b3/registry.png 291w&quot;
        sizes=&quot;(max-width: 291px) 100vw, 291px&quot;
      /&gt;
  &lt;/span&gt;
  &lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;HKEY (handle to a key). Most important are &lt;code class=&quot;language-text&quot;&gt;HKEY_USERS&lt;/code&gt; (HKU) - profile of users, &lt;code class=&quot;language-text&quot;&gt;HKEY_LOCAL_MACHINE&lt;/code&gt; (HKLM)&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Timeline Analysis&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;$MFT (master file table) - check timings of when things are changed
&lt;code class=&quot;language-text&quot;&gt;volatility.exe -f nameofmemorydump --profile=Win7SPOx86 mftparser --output=body &amp;gt;&amp;gt; mftparser.txt&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Reg-Ripper&lt;/li&gt;
&lt;li&gt;Volatility timeline
&lt;code class=&quot;language-text&quot;&gt;volatility.exe -f nameofmemorydump --profile=Win7SPOx86 timeliner --output=body &amp;gt;&amp;gt; timeline.txt&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Files and Directory Analysis&lt;/h4&gt;
&lt;p&gt;Things to check:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;pagefile.sys, index.dat, etc&lt;/li&gt;
&lt;li&gt;Windows event logs (Application, System, Security, DNS)&lt;/li&gt;
&lt;li&gt;IIS/webserver/FTP logs/URL Scan - the web could be a point of entry&lt;/li&gt;
&lt;li&gt;Windows firewall log (%windir%\pfirewall.log)&lt;/li&gt;
&lt;li&gt;setupapi.log - installation of applications and devices&lt;/li&gt;
&lt;li&gt;schedlgu.txt - scheduled tasks&lt;/li&gt;
&lt;li&gt;Application configuration files and logs&lt;/li&gt;
&lt;li&gt;Antivirus/IDS/IAS/ISA Server logs&lt;/li&gt;
&lt;li&gt;Prefetch folder &lt;code class=&quot;language-text&quot;&gt;strings C:\WINDOWS\Prefetch\PWDUMP2.exe&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Evidence of malware, rootkits, etc&lt;/li&gt;
&lt;li&gt;System restore points&lt;/li&gt;
&lt;li&gt;Hybernation file&lt;/li&gt;
&lt;li&gt;Crash-dump files&lt;/li&gt;
&lt;li&gt;LNK files&lt;/li&gt;
&lt;li&gt;Shell-bag - when you open a window&lt;/li&gt;
&lt;li&gt;HKEY_USERS for internet browsing history, last accessed files&lt;/li&gt;
&lt;li&gt;Autorun locations&lt;/li&gt;
&lt;li&gt;MRU lists&lt;/li&gt;
&lt;li&gt;UserAssist&lt;/li&gt;
&lt;li&gt;USB devices&lt;/li&gt;
&lt;li&gt;Geolocation&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Data Recovery&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;When you delete files, the markers in memory for the data are deleted, but not always the data&lt;/li&gt;
&lt;li&gt;You can use a program to search for the data such as PhotoRec. Header files start with certain keys, so it looks for starting with JOJA and footer has xyz.&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3&gt;Lab&lt;/h3&gt;
&lt;p&gt;We are then given a challenge, a Korean defector was caught with a USB stick that we need to investigate.&lt;/p&gt;
&lt;p&gt;First I mounted the contents of the drive to a drive on my VM using OSFMount:
&lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/blog/static/55db41f0441e2e74076a184508eda16f/6e3a5/1-mounted.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 19.888475836431226%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsSAAALEgHS3X78AAABD0lEQVQY0yWOW0sCYRCG9xd2pOwmEwJDiLIuRCK6CCLoOiShm4KILoL+QD8hqMxSk4KV1XVb3fO3J5anz3VgeOeZeWcY5fb+kbuHJy6bN9ROLtitnbJXP6NYPmRlY5tCscJO9Zjq0Tlb5QMW14osF0osrZdyXVjdpLJf56pxzXOzgfLy+kGr3aH92aX3/Uu394M+NgmjFBHGBCLGDyKpkeQk51nO5nNPgusJzKmL4QiUr04HbTik3++jaRpjw+DPNLEsW6aFZduYkke6zmikE4YhU9kfDAaoqspkMkGXM0Pu2bKvvL23yLIMx3HwPA8hhFQ/r13XJYrkd0GQs+8HzCJJ5FfunNM0lZ44vxHHMf/B5BL0uFCssAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;&lt;/span&gt;
    &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Contents of USB&quot;
        title=&quot;&quot;
        src=&quot;/blog/static/55db41f0441e2e74076a184508eda16f/fb8a0/1-mounted.png&quot;
        srcset=&quot;/blog/static/55db41f0441e2e74076a184508eda16f/1a291/1-mounted.png 148w,
/blog/static/55db41f0441e2e74076a184508eda16f/2bc4a/1-mounted.png 295w,
/blog/static/55db41f0441e2e74076a184508eda16f/fb8a0/1-mounted.png 590w,
/blog/static/55db41f0441e2e74076a184508eda16f/526de/1-mounted.png 885w,
/blog/static/55db41f0441e2e74076a184508eda16f/6e3a5/1-mounted.png 1076w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/span&gt;
  &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/blog/static/77ce83f124f5f45d668d35413d4e5e2a/ab1f1/1b.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 44.90909090909091%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABrklEQVQoz4WRz07bQBDG/XSoqkSrFEgrQlS4wLmXXhBHWsEJbly58wJ9gp44AaoK+YNZL3bsrO1d25s4tvk6uwEaJCQsfZrdmdnffCM73w9P8W33B/YOT9Bqd7H0/iOWW2201jpY39zB+tdtrHW28Km9Mddnoy5WvnTxYaWDd8ur6Gzt4Of+Ac6Oj+D8+n2Ji2sPV30flz2Ov26IPwMffS8GFxN4Yw03UBjwBMP7FEN/LjeQ6FOu5wlcuxEuej7OexEc3+cIRiGUyiDSDEmqkCQpRJxASmXzZTlDnEhbK/QEknKa4pTyRUFxWqJuHig3hcPvGbJM0UUjiEZgHsMd8xBFY2rW0BPzsIQQMcZCEEzRsJjg0g7K8pze52iahsAEvLll5HBkJ4YhARmzDmggZrMKs6q2TgwsGgukBDJw+ehcEcxADXBCTp0B40iltE7CwIeSKTXSCnVNquaxquwGWhfWhS6K556ynNpzQ2cL5H5Iq+XI88JONV9FgBeycBK5MLF5jKZWP9WegLe08ohWNauYn9A0/xsX42tarD0DXeZiMByCc27XeW3yW1oE/gMt/ZIfmgcVHQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;&lt;/span&gt;
    &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Contents of USB&quot;
        title=&quot;&quot;
        src=&quot;/blog/static/77ce83f124f5f45d668d35413d4e5e2a/fb8a0/1b.png&quot;
        srcset=&quot;/blog/static/77ce83f124f5f45d668d35413d4e5e2a/1a291/1b.png 148w,
/blog/static/77ce83f124f5f45d668d35413d4e5e2a/2bc4a/1b.png 295w,
/blog/static/77ce83f124f5f45d668d35413d4e5e2a/fb8a0/1b.png 590w,
/blog/static/77ce83f124f5f45d668d35413d4e5e2a/526de/1b.png 885w,
/blog/static/77ce83f124f5f45d668d35413d4e5e2a/fa2eb/1b.png 1180w,
/blog/static/77ce83f124f5f45d668d35413d4e5e2a/ab1f1/1b.png 1650w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/span&gt;
  &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Next I used the Google Translate app on my phone to take a picture of the files and translate them:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Democratic People’s Republic of Korea - country to.mp3&lt;/li&gt;
&lt;li&gt;Target list.zip&lt;/li&gt;
&lt;li&gt;Rootkin.bin&lt;/li&gt;
&lt;li&gt;Target.bat&lt;/li&gt;
&lt;li&gt;Goal.png&lt;/li&gt;
&lt;/ul&gt;
&lt;h5&gt;Targets&lt;/h5&gt;
&lt;p&gt;Looking at the contents of the jpg file as strings, I found the password:&lt;/p&gt;
&lt;p&gt;&lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/blog/static/407d57d1c0dff5f0b58283721bc98cc5/02562/3.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 52.22078482104355%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAACUUlEQVQozzVSWU8aURSeX9nEVlEQg7XbW9M+9ql9aOxrE0lMFAGNCyJENoelUZZhFgYGlHWgLLaVNqlBKmq+nnvVm3w5833n3C/nnDuC8+sKPnz6jDn7a8wtvITVvohZ2wKs8w5Mz9oxY3WQtgTbwgs8tczDMr8Ex6u3mJq24cnUDEUrnlnsWHz+Bh/fv4OglzToSgrpnA61dIpisYhSqYRWq4mzWp1rmnHGUShXoRFXixX+rVfqKBikVWpQD0SkfVEIYuIbTnIaMpJMUBA8DGN9fR2RWAz7/gO4PB5seD3wbm3BQ9je3YV7c5Nz5+oq3F4vNqjGueLExtoahFarhavxGLd3d5hMbmCabYRCIciyjHa7jcFggF63iy6h0+k88B46lGs0GmgSTPJgPv1+H8Jw+JuMJrgjQ3aYmEqlkM1mYRgGN1ZVlUdFUfg6GFg+k8lA1TRUqzVqxMTFxRDC8fExqrUams0mTk9pX1TAOtze2UY8HucmLGe2TJ7P5/O8pl6vc67rOsrlMhr1BmrkI/j8QWRyMsRECjt7fiSSKUQiEbjdbix/WcYa7SUQCMDlcnGd4YD4YegQ0WiU8yPxiHPWtTA4/4HxvwlGV2M+skm7kXI5SJIEn28P4XCYoo8uhvmoJ+kTBIMBBAh+/z5EUeRTMPNkMglhPL43ejxGuYJwLI50VoGs6sgrOhStSLGArHSvabrxgDLPSbLGo1ooQWAPcnl5yTEajdDufMev4R8Mzn/yRbMJuvSqvV4fVzTFze0trunONf0RDJMHMP0vefwHe2WYwkxF0g0AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;&lt;/span&gt;
    &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Password found&quot;
        title=&quot;&quot;
        src=&quot;/blog/static/407d57d1c0dff5f0b58283721bc98cc5/fb8a0/3.png&quot;
        srcset=&quot;/blog/static/407d57d1c0dff5f0b58283721bc98cc5/1a291/3.png 148w,
/blog/static/407d57d1c0dff5f0b58283721bc98cc5/2bc4a/3.png 295w,
/blog/static/407d57d1c0dff5f0b58283721bc98cc5/fb8a0/3.png 590w,
/blog/static/407d57d1c0dff5f0b58283721bc98cc5/526de/3.png 885w,
/blog/static/407d57d1c0dff5f0b58283721bc98cc5/fa2eb/3.png 1180w,
/blog/static/407d57d1c0dff5f0b58283721bc98cc5/08f6a/3.png 1770w,
/blog/static/407d57d1c0dff5f0b58283721bc98cc5/02562/3.png 2319w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/span&gt;
  &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Which I used to unzip the zip file:&lt;/p&gt;
&lt;p&gt;&lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/blog/static/a86b08d31715bef6501959cc0c6ac298/511d6/4.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 20.64404830362277%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA/UlEQVQY002OuU7DUBBF/ak0FCRpIICQMChIIERDgYTYREdBR0GH4AsQBVUQMYiQzbKf/bw887wlB8cFpLiamTN3FuP2/pHrmzu2949ZWtlkublFY9WktbFHc71Da1EVq3m7Q2Ntl7Z5xM7hGebBCeenlzxcXWC8WK+89fp8jm0+vscMrAHOsE9WlBTFjLyYLmhGlpe15nWaFaRpTpJoZBDjhglG13rnazhmNJogfR8pJY7jYE9sXFfgV0wI8cejKKpzITzCMKx7XuVRSqHiGOO5J3jqhvgqJ8tSkh+N1rpa5uJVQ1IGeJ5PEAT1AaWSyjf/6j9qnZLnBWU55RdLNRZPK4ZqSAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;&lt;/span&gt;
    &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Unzipped file&quot;
        title=&quot;&quot;
        src=&quot;/blog/static/a86b08d31715bef6501959cc0c6ac298/fb8a0/4.png&quot;
        srcset=&quot;/blog/static/a86b08d31715bef6501959cc0c6ac298/1a291/4.png 148w,
/blog/static/a86b08d31715bef6501959cc0c6ac298/2bc4a/4.png 295w,
/blog/static/a86b08d31715bef6501959cc0c6ac298/fb8a0/4.png 590w,
/blog/static/a86b08d31715bef6501959cc0c6ac298/526de/4.png 885w,
/blog/static/a86b08d31715bef6501959cc0c6ac298/fa2eb/4.png 1180w,
/blog/static/a86b08d31715bef6501959cc0c6ac298/511d6/4.png 1739w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/span&gt;
  &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;And read its contents, the list of targets! (included S-Oil Onsan Refinery, GS Caltex Yeosu Refinery)&lt;/p&gt;
&lt;p&gt;&lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/blog/static/f0ec9196d316c5129de247ce423f8f06/34f25/5.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 8.734939759036143%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAiElEQVQI1yWLyw7BUAAF+8u0VRVVRGJLrldUNVa+x94HWCK9r+rNuOoks5nMCYrqykocEfszYleyPVSsNwXxaE44nBKlM2JPmOQdkXdpviQZL+gPMs+EXpx1zam4ENzuD4ySSKWRUvF8valrSdN8UFpjjMFYy2/OOdrWoX2rvZdKYW3zb4ztvl+RvYCnwaVvcQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;&lt;/span&gt;
    &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Opened file&quot;
        title=&quot;&quot;
        src=&quot;/blog/static/f0ec9196d316c5129de247ce423f8f06/fb8a0/5.png&quot;
        srcset=&quot;/blog/static/f0ec9196d316c5129de247ce423f8f06/1a291/5.png 148w,
/blog/static/f0ec9196d316c5129de247ce423f8f06/2bc4a/5.png 295w,
/blog/static/f0ec9196d316c5129de247ce423f8f06/fb8a0/5.png 590w,
/blog/static/f0ec9196d316c5129de247ce423f8f06/526de/5.png 885w,
/blog/static/f0ec9196d316c5129de247ce423f8f06/fa2eb/5.png 1180w,
/blog/static/f0ec9196d316c5129de247ce423f8f06/08f6a/5.png 1770w,
/blog/static/f0ec9196d316c5129de247ce423f8f06/34f25/5.png 2324w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/span&gt;
  &lt;/a&gt;&lt;/p&gt;
&lt;h5&gt;Malware&lt;/h5&gt;
&lt;p&gt;Looking at the strings of the .bin file, we see &lt;code class=&quot;language-text&quot;&gt;cmd.exe /q /c net share shared$=%SystemRoot% /GRANT: everyone, FULL&lt;/code&gt;
It looks like it is executing a command to create a network share to the system root and give full permissions to everyone. /q is for quiet mode so it’s undetected.&lt;/p&gt;
&lt;p&gt;When running the malware, the first thing I see is a file called igfxtrayex.exe that is created. By reading and googling strings and using the tools from last week, I think the malware is adding itself as a service to Windows Schedule Management Service (WinsSchMgmt). It looks like it creates and runs multiple files including dpnsvr16.exe and net_ver.dat. It also seems to change soooo many registry keys (just a small sub section below):&lt;/p&gt;
&lt;p&gt;&lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/blog/static/e4a1ad56282f2663afe586ba13b91236/b7132/bad.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 92.33817701453104%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsSAAALEgHS3X78AAADOklEQVQ4y01UZ3PaQBDV//8nKZMySb4nsR07ITYGdQlVkADTZIpgKH55uyIkzNwMc9rbe23PuG+34YcpbMuH5fbgOAFcrwczCmAGEVqWiaQosVrvsVhuUS13WDzXmMxXmFc1ZtUGU/6vVjt+28IIQx/FsETU62Gz2aDerPGj24Ht2phOJ8j7GZIsweTpCePRCMPhELPZFEkSo6oq1PUGcRxhxG8bnjU810UyGMB1Pby8vGCzXuPV12/41fqNLMsxKAZ4aD/CdVw4toNu10QQhGThoiyHqJ4rZGmGlGvNs4bvedrQdhwcj0fdfPv9Ci02TJIEWZ6ha5rwWOfxUsuyEYYhfN/HaDzGcrnUuqIosN3tYMRRhAHhxtw8nU7Ybmt8ufsJ07RYVKKkHAEb5ESbJimiKMaAANKUMlASkWk2m2G1Wul5RZiVzSHZkIL319ek2dZbZVm2TY0jIuvBI7I8z9m4h/ligcNhr2iDICD9ZxgOqca8UagcjydSXuH1N9GwpdRiit9+FA29i4ae1zR4olGHw4HmTRXldkuXezzUp3MhXRaEdV3j449bdDpdRVIQvc/D0rzHGmnU7w8QnZ0VqrL2+z3kZ4RSwIaizd+Gn25v8djtakRG45HSjKh1EifauN/va8OFUj5Qz1T31pTrQrlx+aQuvzlTlkJxucPmorVEx6Tj0tzzPZoyxW63hU2NJQXPoqEImpWFbvw15d31DR4e2nowzVI1JWT2Ap9TxNxKIgThfD5XqmEYaC6n1NEQXTQ28b/YfL67O8emYHhFw7AJr8YmUg0le2OaItMidWKM0Ddc1+GsFqqTItRgf9fYSFTEZQm2IPTprkPaAsIPfL1MDJlMJhpwbaijx/Gy7UZDafjmPClxHF80lCmRZVqWjp5PDQWhaC51OikamzNlofI/5S6bCLXyHBuhKy5Lvcy4UJYcihGj0Vipy+heJuWSQ5ry4eaGYe6cJ2UAhyzkQpHApzFplml8nkhVYiZ5lYsVoXuhbP+LDTVs/b7XEIubj50O6fpNbJRy42oT/IJoU50Uea0UYcpNQXEx5eoK94xNRiR5P1dTxBB9wiS3pC6mzGZNbKROnjJB+wcsPx3qgm7HJgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;&lt;/span&gt;
    &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Opened file&quot;
        title=&quot;&quot;
        src=&quot;/blog/static/e4a1ad56282f2663afe586ba13b91236/fb8a0/bad.png&quot;
        srcset=&quot;/blog/static/e4a1ad56282f2663afe586ba13b91236/1a291/bad.png 148w,
/blog/static/e4a1ad56282f2663afe586ba13b91236/2bc4a/bad.png 295w,
/blog/static/e4a1ad56282f2663afe586ba13b91236/fb8a0/bad.png 590w,
/blog/static/e4a1ad56282f2663afe586ba13b91236/b7132/bad.png 757w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/span&gt;
  &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/blog/static/b42eb19c22027bf891596c4fb49d9bf4/6ea70/bad2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 16.801075268817204%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsSAAALEgHS3X78AAAAsklEQVQI1zWPzQrCMBCE+/4v40k89yII4qHpr20aMU0qNdLE3grJuKl0YWGHYb+dTYQQ6IcBddMglp0t0usRRZFDKQ1FHmMMVVWhbVtw3mNdV4ieQ2kN7z3KsiS/hjEfJEI8NmBeFAjBw1mH9HJAxjKYt8E4jsh3YNcRkP+BgkOTF0Kgo2qDzxQmGUgMrxcaShjTOPfF+Xai5TuklFiWZVuKSfaOWsonpmnaZk2w+I21Fj/urd0XrBEBcgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;&lt;/span&gt;
    &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Opened file&quot;
        title=&quot;&quot;
        src=&quot;/blog/static/b42eb19c22027bf891596c4fb49d9bf4/fb8a0/bad2.png&quot;
        srcset=&quot;/blog/static/b42eb19c22027bf891596c4fb49d9bf4/1a291/bad2.png 148w,
/blog/static/b42eb19c22027bf891596c4fb49d9bf4/2bc4a/bad2.png 295w,
/blog/static/b42eb19c22027bf891596c4fb49d9bf4/fb8a0/bad2.png 590w,
/blog/static/b42eb19c22027bf891596c4fb49d9bf4/6ea70/bad2.png 744w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/span&gt;
  &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;It also tries to connect to a bunch of IPs starting with 43.130.141:&lt;/p&gt;
&lt;p&gt;&lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/blog/static/f7fe0b68d9a773f19e1c8dd56044ce2e/95632/bad3.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 576px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 67.1875%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAABq0lEQVQ4y42SyU/CQBSHSziZaEw8aNlKF9ppC20pILUKQa/uGhcS48WLJ///48/5jUwim/EwmaXzvvfNezU+Pr8wnV1gXE6Q5iOUk3P0RwVGJxMMizP0siHidIBsMEaSH8v9CNmwwEDe8fwQe/sH2NndV/PhoQnj9vEFnmvD8zzU6zUEvg+r1UIoBHy/g3rNREOeu46tZtM8gmO3kfR6qMlvhmEsj+f5mwoWIoRltRHHMVzXRbfbRRiGaEl4y7JUQsdx0Gg0ZCIfSZJIYA2VSmUBq/ysaShEgCAIJNBCFEUqkGAhEzWbTQUlkIm473Q6CmiaGwwv754gAl9lJZBWtm0rMJPQyFoYEsg91z355I3A64eXJaA25KwNrZUn0/BPYBQKFdxub6mhHDyjua5hmqaqhmvAq/tnxFGomkIgQQymAS1/Azm4/idQLAFXDfnkfxleP7xuBWpDXUPWThtmWbYZePM4X3uy7uJvIGE8Z5PY/a1ANmVTDVcN9V/AO+w2gVxXq9Vl4NP8HaenJfI8Vxaz2UzVpyxLFEWhbLQRoUzW7/cxnU5VTVcNvwGfwWV4/GK1vgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;&lt;/span&gt;
    &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Opened file&quot;
        title=&quot;&quot;
        src=&quot;/blog/static/f7fe0b68d9a773f19e1c8dd56044ce2e/95632/bad3.png&quot;
        srcset=&quot;/blog/static/f7fe0b68d9a773f19e1c8dd56044ce2e/9d04d/bad3.png 148w,
/blog/static/f7fe0b68d9a773f19e1c8dd56044ce2e/f1dcb/bad3.png 295w,
/blog/static/f7fe0b68d9a773f19e1c8dd56044ce2e/95632/bad3.png 576w&quot;
        sizes=&quot;(max-width: 576px) 100vw, 576px&quot;
      /&gt;
  &lt;/span&gt;
  &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;It also seems like it may be loading a window and drawing text to it, based on calls to BeginPaint, DrawText, and LoadIcon.&lt;/p&gt;
&lt;h5&gt;Deleted files&lt;/h5&gt;
&lt;p&gt;The following files were deleted (found using PhotoRec):&lt;/p&gt;
&lt;p&gt;&lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/blog/static/44adaa83cacd14a017263fe5ccade7cf/a7964/2-photorec.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 37.025796661608496%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAAA+UlEQVQoz31R2W6EQAwDcd9XgeUUCIEE4nrY/v+nufJUs+pDdx+szCiJHSfK8/mN8zyxriuu68JxHNj3Hfd9Y1kWbNuGYRgwTRO6roPrulAU5T2apkEURciyDH3f4/F4oCgKAdu2YRgGVFWFpmmfiSSy7At1XQuCqqrg+z4cxxECcRyLqSjIYk7HN0WYI9I0RRiG0HX9l1DTdNGc5/m/U0gB5pIkEbWcXDoqyxJt24ooeoIgEIqmab4sep73IvoL1jBalvXe8jzPwvI4juIIVKIICdlIEVrin5Zp8+Nhuq4X+yMprynfPA7XQCFGQu6MOUa5Kg5B+xT6AdMoo3BPwEyuAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;&lt;/span&gt;
    &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;&quot;
        alt=&quot;PhotoRec&quot;
        title=&quot;&quot;
        src=&quot;/blog/static/44adaa83cacd14a017263fe5ccade7cf/fb8a0/2-photorec.png&quot;
        srcset=&quot;/blog/static/44adaa83cacd14a017263fe5ccade7cf/1a291/2-photorec.png 148w,
/blog/static/44adaa83cacd14a017263fe5ccade7cf/2bc4a/2-photorec.png 295w,
/blog/static/44adaa83cacd14a017263fe5ccade7cf/fb8a0/2-photorec.png 590w,
/blog/static/44adaa83cacd14a017263fe5ccade7cf/a7964/2-photorec.png 659w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/span&gt;
  &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/blog/static/e8a807dd7bb7eb6705ec5cccd926b26e/214b2/2a.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 47.423887587822016%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABMUlEQVQoz22S2ZaCMBBE+f/fm4fhyLCIHgFBIWFfa1Jx2qMOD6GbpFN9K4lTXGIEPx6O8Qm32w1t26Jpmueo6xp5UeB6zZHnOaqqsrEwc9qssUZrjSzL0Pc9HKULeN7BDM9uXpYF8zw/xzRNuN/vthkjGzKK6DAMtq4sy4dgrjSCKML5fDKL41OQUXISlIaMmyhISs5JU9Yppay4k51DHKMAsbFMwnVd3woZlaqsIDeRovoTl6Z0wblxHA1h8AX/8I3oGJsz0buC3Pxp+VNQ7Dtt2+CSJEiS1E68nuGrZdIxsoZOJJcaXo4lpIUwDOH7vi36T/i4FBLIK2CkgBAyT9MHkMMPfxJD2XXdLqEQMQqh0HGQjOuWkAukc13XvLUrtm17F9x5Nsx5BNKQrngpdPsLMjqz67qKpF0AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;&lt;/span&gt;
    &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Recovered files A&quot;
        title=&quot;&quot;
        src=&quot;/blog/static/e8a807dd7bb7eb6705ec5cccd926b26e/fb8a0/2a.png&quot;
        srcset=&quot;/blog/static/e8a807dd7bb7eb6705ec5cccd926b26e/1a291/2a.png 148w,
/blog/static/e8a807dd7bb7eb6705ec5cccd926b26e/2bc4a/2a.png 295w,
/blog/static/e8a807dd7bb7eb6705ec5cccd926b26e/fb8a0/2a.png 590w,
/blog/static/e8a807dd7bb7eb6705ec5cccd926b26e/214b2/2a.png 854w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/span&gt;
  &lt;/a&gt;
&lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/blog/static/2b0d69a3aa4c4a034dac4f125a529f91/29454/2b.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 39.0452876376989%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAABHklEQVQoz22S25KDIBBE+f+fVMzilhdEwLumOvSspFKpfegSxslxuidqig5aa+hKY14WPJ9PnOf51nVdmOcZwzBgHEf4ELCuK5xzWFL/vu9/fUnTNEEFp1GWGlVVSRMB/wFtAvI9odu2wVqLPqnrOhzHkeCznFX0Bo/HD4wxUiCAU2Ywn5yEMO89QpqQwAznk0DWeJcJi6JMKgTatI18PcYoMIpW+r6XH1O0zAgo1gmkeFfBNwKihsFKJrnhvIGS4T0hlTPMU9MJ+3lWDLlKSzGmlmK2+2n5cynhXkq2S6s5JtbVb2dly0VZpvHtG/K9FC4gT8RMmTfPW3JEWIxB7KvejajrGm3bSm60/A3kBjOMPbIk/oXSnR9jDyfluxc5iWa13eH4rAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;&lt;/span&gt;
    &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Recovered files B&quot;
        title=&quot;&quot;
        src=&quot;/blog/static/2b0d69a3aa4c4a034dac4f125a529f91/fb8a0/2b.png&quot;
        srcset=&quot;/blog/static/2b0d69a3aa4c4a034dac4f125a529f91/1a291/2b.png 148w,
/blog/static/2b0d69a3aa4c4a034dac4f125a529f91/2bc4a/2b.png 295w,
/blog/static/2b0d69a3aa4c4a034dac4f125a529f91/fb8a0/2b.png 590w,
/blog/static/2b0d69a3aa4c4a034dac4f125a529f91/29454/2b.png 817w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/span&gt;
  &lt;/a&gt;&lt;/p&gt;
&lt;h5&gt;Username/passwords&lt;/h5&gt;
&lt;p&gt;After opening a file recovered via PhotoRec, I searched in the .bin file for the string ‘spe’ (lecture hint) and found the following (at offset value 0x3ebbd):&lt;/p&gt;
&lt;p&gt;&lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/blog/static/f95e466da5c2bd0bbcd609d4ccf11ffc/bd485/6.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 50.32453483340545%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAACL0lEQVQoz22RW08acRDF93NataJSb2nSN/sJmr71oUnTh/atiVoNTVoJ1guCVBEqCCwLKlor12Vxl0sCgcXw6+ymJKbpJCdzZnZmcv5nlY/vP/D6zVtmZpd5OreMZ36JOe8i3sUVPN4lJme8zC8+Z/bZChPTc8x4V1h+8ZJpzwJPpmaZlN7ElIcFmXm1uoqSUtNkzsPEzzKcqxdktTy5nMZlPo+maiRTWdJqnnQmRyZ7QUpyKp11c8JBWiD9+Nd9jjcDKKFwhOjPFLGzJKfxBPvBEMlEko1tP++2tvi0u8tGOMza4SHrwSCboRDrUvsiR4QFoUhEIPzoiOD+AcrNzS+63S6jEbTbbVGjYfe6aO0OX+oG2zWd7+UKO6USO+UygcY9gXqdmGXxbzw8PKDUjQa2PZCDI3q9HqqWo22ZpGXRVyrzTQ7574r4i0UCgh1dZ7tS5dgwsAcDBoL+3+wIU6LRKIVCgdvbWwpXV5zGYpwl0iTUHCcplaj4dZJxoLk8Ji+IZnMuz+bE8/wl2sUV+ctrNOHK2mcf4R+n7B2E2dj04Q/scX3zm2qlwr2oN0RRvVajJqoMsUCvVtGFl4slqsLvRL0hc7rMtVptlFKljmk1RbaN2Mi9aWEKdDlimiaNRsOFs9RsNl1uWpb7zamd7Hjv9Dudjhws16TREkOHrrGGeNNqtej3+64vw+HQzbZtuz6Pw6Hj2sljKEX3YNv9Q05U5DktqUf8P8aLj+vH8QdtRruELp3jjgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;&lt;/span&gt;
    &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Usernames and passwords&quot;
        title=&quot;&quot;
        src=&quot;/blog/static/f95e466da5c2bd0bbcd609d4ccf11ffc/fb8a0/6.png&quot;
        srcset=&quot;/blog/static/f95e466da5c2bd0bbcd609d4ccf11ffc/1a291/6.png 148w,
/blog/static/f95e466da5c2bd0bbcd609d4ccf11ffc/2bc4a/6.png 295w,
/blog/static/f95e466da5c2bd0bbcd609d4ccf11ffc/fb8a0/6.png 590w,
/blog/static/f95e466da5c2bd0bbcd609d4ccf11ffc/526de/6.png 885w,
/blog/static/f95e466da5c2bd0bbcd609d4ccf11ffc/fa2eb/6.png 1180w,
/blog/static/f95e466da5c2bd0bbcd609d4ccf11ffc/08f6a/6.png 1770w,
/blog/static/f95e466da5c2bd0bbcd609d4ccf11ffc/bd485/6.png 2311w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/span&gt;
  &lt;/a&gt;&lt;/p&gt;
&lt;h5&gt;Strategy to Target&lt;/h5&gt;
&lt;p&gt;DO NOT RUN THIS FILE! It will destroy your computer. 😱&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Thoughts on Malware (Defense Against the Dark Arts)]]></title><description><![CDATA[As part of my effort to obtain a Computer Science degree, I am taking a class called “Defense Against the Dark Arts” on Security topics. I’m…]]></description><link>https://michelelarson.com/blog/security-malware/</link><guid isPermaLink="false">https://michelelarson.com/blog/security-malware/</guid><pubDate>Fri, 11 Jan 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;As part of my effort to obtain a Computer Science degree, I am taking a class called “Defense Against the Dark Arts” on Security topics. I’m actually really excited for this class, both its topics and its approach, which is that the lectures are given by experts who work in the field. As part of the class, I am required to write blog posts each week on the topic, so here I go!&lt;/p&gt;
&lt;p&gt;The first week talks about malware (malicious software). I had a small understanding of malware, in that I knew what it is, but I had never thought about it beyond that. This week, the lecturer is from McAfee, and I learned that what the security research team is doing is writing drivers to detect malware, and in their approach to writing these drivers, trying to be able to detect future variations, because there’s just so much malware to keep up with.&lt;/p&gt;
&lt;p&gt;First we start off with some basic information about malware and definitions:&lt;/p&gt;
&lt;h3&gt;Some different types of malware:&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Viruses&lt;/strong&gt; (parasitic - when it depends on another file, polymorphic - code keeps changing) and Worm - (spreads quickly)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Trojans&lt;/strong&gt; - backdoor (has remote control of system, attacker will be active so it’s more targeted than a bot), downloader (has remote control of system), password stealer, keylogger, bot (waits for remote commands) &lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Potentially Unwanted Program, Adware, Spyware&lt;/strong&gt; (PUP, PUA, PUS) (commercial, can install other programs along with one you want)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Ways to cause infection of malware:&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;The biggest risk is people!&lt;/li&gt;
&lt;li&gt;USB sticks&lt;/li&gt;
&lt;li&gt;Mobile apps&lt;/li&gt;
&lt;li&gt;Drive by downloads - such as JavaScript exploit from visiting a website&lt;/li&gt;
&lt;li&gt;PDF&lt;/li&gt;
&lt;li&gt;Office files&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Malware Definitions:&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;White listed&lt;/strong&gt; - clean&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Black&lt;/strong&gt; - dirty&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Grey&lt;/strong&gt; - trying to discover what the malware is doing&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Sample&lt;/strong&gt; - piece of malware&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Goat&lt;/strong&gt; - machine used to investigate malware. Some malware knows when it’s running in a VM, so sometimes you want to run on a real system. Goats are sacrificial machines that are on purpose infected.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Honeypot&lt;/strong&gt; - sitting duck waiting for it to be infected&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Replication&lt;/strong&gt; - what is the malware doing? So we can study its behavior.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Hash&lt;/strong&gt; - calculating using cryptographic algorithm (commonly md5) the value of a file. It’s used to verify values of files. (Is it the same file?)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Trojan horse&lt;/strong&gt; - users tricked into opening a program because they think it’s legitimate software. Can also create a backdoor that gives users access to your system&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Spyware&lt;/strong&gt; - programs that collect personal info without the user’s knowledge. &lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Ransom-ware&lt;/strong&gt; - encrypts your files and asks for payment to unlock them - bitcoin&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;POS malware&lt;/strong&gt; - (point of sale) trying to steal your credit card (Target, Home Depot, Staples)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Patient zero&lt;/strong&gt; - first attacked&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Naming convention for malware:&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Type of malware + Platform + Family (name in malware) + Variant of Family + ! + information&lt;/code&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;The next part was my favorite part of the week, learning about strategies for investigating malware and doing a lab to investigate an actual malware sample. I learned there are different tools out there that you can use to see what is happening, but there’s also a lot of basic methods you can use to poke around the system.&lt;/p&gt;
&lt;h2&gt;Strategies to replicate/investigate malware:&lt;/h2&gt;
&lt;h3&gt;Before Starting:&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Transport it in an inactive state by renaming it using the command line (ie remove ‘.exe’ so it won’t execute)&lt;/li&gt;
&lt;li&gt;Have isolated environment so it doesn’t destroy anything you need&lt;/li&gt;
&lt;li&gt;Take a snapshot of your machine before you start, so you can easily revert back to a clean state.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;General Research Tactics:&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Upload/check sites: You can hash the file and upload to different sites to see if anyone else has encountered the malware. Virustotal, Malwr, Wepawet, Comodo are examples of sites.&lt;/li&gt;
&lt;li&gt;Compare snapshot before and after running it to see what is changing&lt;/li&gt;
&lt;li&gt;Bait the malware with what it’s looking for (ie if it’s trying to steal credit card numbers, feed it some fake credit card numbers)&lt;/li&gt;
&lt;li&gt;Check PE file (starts with MZ) - headers, directories, section tables, code, imports, data&lt;/li&gt;
&lt;li&gt;Do a text analysis by searching google (maybe someone has a username and posted online, or you find an IP address you can investigate)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Built in Windows tools you can use to investigate:&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Task Manager&lt;/li&gt;
&lt;li&gt;MS Config&lt;/li&gt;
&lt;li&gt;Command Prompts - IPconfig/displayDNS&lt;/li&gt;
&lt;li&gt;Windows search for the time when last files were added to system &lt;/li&gt;
&lt;li&gt;Task Scheduler&lt;/li&gt;
&lt;li&gt;Registry - because malware wants to survive a reboot, it might add run keys in registry&lt;/li&gt;
&lt;li&gt;attrib &lt;filename&gt;&lt;/li&gt;
&lt;li&gt;Process Explorer - Task manager/system monitor&lt;/li&gt;
&lt;li&gt;Process monitor - monitor all changes on system like opening files. File and capture events, search for Evil.exe.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Other tools we’re using in class:&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Flypaper - block TCP/IP connections and blocks program from exiting&lt;/li&gt;
&lt;li&gt;Fake Net - listening on several ports&lt;/li&gt;
&lt;li&gt;Antispy - detect spyware&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Static analysis techniques:&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Open the program in text editor and analyze source code&lt;/li&gt;
&lt;li&gt;Open in IDA Pro - tool to disassemble code and to see how it is running&lt;/li&gt;
&lt;li&gt;XOR encryption - check for bit flipping (sometimes authors will flip values to hide things)&lt;/li&gt;
&lt;li&gt;File Insight - A Mcafee tool where you can try to make the code more readable by checking for bit flipping, swapping, and string dumps&lt;/li&gt;
&lt;li&gt;Packer - some malware is compressed and/or encrpyted, so you need to use a packer to return it to its readable state&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Next the lectures talked about APT, or Advanced Persistent Threats.&lt;/p&gt;
&lt;h3&gt;APT&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Advanced&lt;/strong&gt; - attacker is fluent with techniques&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Persistent&lt;/strong&gt; - attacker has an objective and works to achieve goals without detection&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Threats&lt;/strong&gt; - attacker is organized, receives instructions, funded/motivated&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Actors&lt;/strong&gt; - can be activists, governments, organized crime groups, competitions, malicious insiders or ex employees&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Motives&lt;/strong&gt; - money, revenge, ideology, excitement&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Targets&lt;/strong&gt; - corporations, governments, defense contractors, anyone&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Goals&lt;/strong&gt; - use stealth to avoid detection, create backdoors to allow greater access, initiate primary mission, leave undetected&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Kill chain&lt;/strong&gt; - reconnaissance, weaponization, delivery, exploitation, installation, command and control, actions on objectives&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;The last topic was also really interesting to me: reconnaissance. The lectures talked about ways someone could go about planning an attack to get information. It’s scary how easy it is.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;You can research people at the company on LinkedIn to find out who works there and the way the company structures their email addresses.&lt;/li&gt;
&lt;li&gt;You can research what those users visit, what vendors they use, and send fake emails where you get people to click (water hole attack)&lt;/li&gt;
&lt;li&gt;You can find a lot about what technologies a company is using (on job listings you can see what software they are using; check metadata in files published online (version of pdfs, word, OS, etc)&lt;/li&gt;
&lt;li&gt;Delivery - you can implement a fake wifi, something that requires Facebook login, that people at the company may use and you can then infect them&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item></channel></rss>