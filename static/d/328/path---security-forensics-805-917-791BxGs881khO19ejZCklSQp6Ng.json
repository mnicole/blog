{"data":{"site":{"siteMetadata":{"title":"Thoughts on Things","author":"Michele Larson"}},"markdownRemark":{"id":"03123aa6-6301-546c-95a4-4f2c5b10c124","excerpt":"This week focuses on how to investigating security incidents. You should be aware of the best way to investigate it while being careful to preserve evidence…","html":"<p>This week focuses on how to investigating security incidents. You should be aware of the best way to investigate it while being careful to preserve evidence.</p>\n<p><strong>Side note - the lecturer talks about the book, <a href=\"https://www.goodreads.com/book/show/18154.The_Cuckoo_s_Egg\">The Cuckoo’s Egg</a>. I read it last year and loved it!</strong></p>\n<h3>Types of cases you may investigate</h3>\n<ul>\n<li>Fraud</li>\n<li>Intellectual Property</li>\n<li>Hacker Intrusions/Data Breaches</li>\n<li>Inappropriate use of Internet</li>\n<li>Child Exploitation</li>\n<li>eDiscovery supporting Civil or Criminal Litigation</li>\n</ul>\n<h3>Stages of Investigation</h3>\n<ol>\n<li>Evidence acquisition</li>\n<li>Investigation and Analysis</li>\n<li>Reporting results</li>\n</ol>\n<h3>Forensics</h3>\n<ul>\n<li>Includes: Identifying, preserving, analyzing evidence and presenting results.</li>\n<li>Could find evidence in network, operating system, databases and applications, peripherals, removable media, human testimony</li>\n<li>To keep in mind: It’s not up to you to judge guilt. It’s up to you to show what happened. If you think someone is guilty, you look for information to prove your opinion, so it can make you biased while investigating.</li>\n<li>Need to describe results in a way that a judge will understand. Something the lecturer does is ask questions like an attorney to see if there’s anything a judge might ask that they can clarify now.</li>\n<li>Always check times and keep records of times.</li>\n<li>Any time you do anything, it affects the memory and could erase something.</li>\n<li>Locard’s Exchange Principle - when two things interact, there is always transference of material. Thoroughly document anything you do on a live system.</li>\n<li>Triage - There may be different ways to do something. You should check multiple ways to make sure you can come to the same conclusion.</li>\n<li>You can’t log into accounts even if you come across the username and password. You need permission from a judge. It has to be relevant to the case.</li>\n<li>Harddrives are giant and there may be a time limit. You also might get additional harddrives, portable harddrives, cell phones, etc. It takes time to process the data.</li>\n<li>Whitelisting is good to match checksums and verify files are ok and you don’t have to waste time investigating them. The person processing the harddrive will do a checksum of the entire harddrive. The first thing you should do is check that to make sure the evidence wasn’t tampered with.</li>\n</ul>\n<h3>Incident Response Process</h3>\n<ol start=\"0\">\n<li>Incident Response Team Preparation</li>\n<li>Incident Detection</li>\n<li>Initial Response</li>\n<li>Formulate Response Strategy</li>\n<li>Investigate the Incident\n4a. Data Collection\n4b. Forensic Analysis\n4c. Perform Non-Forensic Investigation</li>\n<li>Document Findings\n5a. Administrative Action</li>\n</ol>\n<h3>APT Case Evidence</h3>\n<ul>\n<li>Reconnaissance: Firewall/IPS logs</li>\n<li>Delivery - Email Gateways logs, proxy logs, internet history, Java-IDX files</li>\n<li>Exploitation - Windows Event logs, crash dump files</li>\n<li>Installation - $MFT, memory dump registry, prefetch-files</li>\n<li>Command and Control - Memory dump, firewall logs, proxy logs, netflow</li>\n<li>Actions on Objectives - $MFT, memory dump registry, prefetch files, netflow, remote tools</li>\n</ul>\n<p><em>Initial Response - Shutting off the machine can destroy evidence, but you should pull network cable or block port (attacker may be on network still, even watching you!)</em></p>\n<h4>Order of Volatility - RFC 3227</h4>\n<ul>\n<li>Gather evidence in specific order, capturing the most volatile things first</li>\n<li>System memory</li>\n<li>Temporary file systems</li>\n<li>Process Table and Network Connections</li>\n<li>Network Routing Information and ARP cache</li>\n<li>Forensices Acquisition of Disks</li>\n<li>Remote Logging and monitoring data</li>\n<li>Physical config and network topology</li>\n<li>Backups</li>\n<li>Non volatile data (Time/Data stamps, event logs, web/application logs, registry)</li>\n<li>Relevant logical files (Unknown executables, attacker tools, any other files related to incident)</li>\n</ul>\n<h4>FTK Imager</h4>\n<ul>\n<li>Easy free tool, to dump memory, but leaves an imprint in memory so it’s better to do with commands.</li>\n<li>Note - Never install forensics tools on a suspect’s computer, because you’re influencing!</li>\n<li>Capture memory - don’t store it on desktop. usually will want to store on a shared network. Naming - operation + serial number or date + .mem. You can decide to include pagefile</li>\n<li>Add evidence item - you can copy external sources</li>\n<li>Take a look - find root -> $MFT master file table. You can export it from this tool</li>\n<li>Create disk image, pick encase (E01) as format or raw (DD)</li>\n</ul>\n<h4>Physical memory - system memory (RAM) - short term memory</h4>\n<p>You can get…</p>\n<ul>\n<li>All running processes at time of snapshot</li>\n<li>All loaded modules and DLL’s including malware</li>\n<li>Running device drivers, including rootkits</li>\n<li>Open files for each process, including path to file on disk</li>\n<li>Open registry keys for each process</li>\n<li>Open network sockets including IP address</li>\n<li>Decrypted versions of data</li>\n<li>Contents of windows</li>\n<li>Keystrokes</li>\n<li>Email attachments, file transfers</li>\n<li>Cryptographic key material</li>\n<li>WEP and WPA wireless keys</li>\n<li>Usernames/passwords</li>\n</ul>\n<h4>Analyzing Memory Dumps</h4>\n<ul>\n<li>Look for a printable string</li>\n<li>Reconstruct internal data structures</li>\n<li>Search for static signatures of kernal data structures</li>\n</ul>\n<h4>Volatility</h4>\n<ul>\n<li>Advanced memory forensics framework</li>\n<li>Plugins - malfind, csrpslist, orphan threads, PSList, PSScan, svcscan, ldrmodules, impscan, apihooks, idt, gdt, callbacks, driverirp, psxview, ssdt<em>ex, ssdt</em>by_threads</li>\n<li>Yara - Malware plugins for Volatility</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">volatility.exe -h    // shows options\nvolatility.exe -f nameofmemorydump pluginname\nvolatility.exe -f nameofmemorydump --profile=Win7SPOx86 pluginname</code></pre></div>\n<p><em>Plugins:</em></p>\n<ul>\n<li><code class=\"language-text\">imageinfo</code> - tells us windows operating systems. image date and time - when you took the memory dump</li>\n<li><code class=\"language-text\">psscan</code></li>\n<li><code class=\"language-text\">dlllist -p &lt;processid&gt;</code></li>\n<li><code class=\"language-text\">netscan</code></li>\n<li><code class=\"language-text\">Deskscan</code> - </li>\n<li><code class=\"language-text\">Getsids</code> - see which user rights the malware was running</li>\n</ul>\n<h4>Windows Registry</h4>\n<ul>\n<li>\n<p><code class=\"language-text\">regedit</code> in run window\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/87791a29882b11a34ebbf788ee275572/4f5b3/registry.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 291px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 79.03780068728523%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsSAAALEgHS3X78AAADEUlEQVQ4y52S20sUYRjG518oqMD7LrsqqPAmb0KILjpQKeJFYGrioQgFS/F0oWWJZpIgnaBCkP6CrrU0a13X3dnjzOwcdg47M7utGrqHp/ebXRUv8qIPHr73m8Pve94DV1P/EFeaulHfOYC2Jy/Q+ngcLb3P0NQzhobOQdR3DOJSXReqqu/gxPmbOH7uOo6d3dO1isrn4ySuprkXp+8242pjOxraenD73qOKulFbdx+1t1pw5nIjuKpqcCcvHK1TF8HdaO3H6OxHTL5ZwNTbBUzMzePp608YefkeQ1MfMDD5Dt2js+gamcGD4Rl0Db/y1DE4jc6hctw5NL0vrn1gGtF4CnwsBUl1sRYQkJBdRBMG1oMiRCULIWkjHNPomY5QRIGkZJCkbzd4GXHBhOUWYdq7pDwB+yegW1nEJQOBkI6EqEGSDYgkFguSDkVLl5Uq72rKhma4kDULsmp5/+tmBikS1zc2AwdAWLHwed6HaEyAz+fDr5+rWCUtLS0ik83i6FXa37n2vudeWCjksbX9B9l0AL9dEZKkIhKNQjcMOI4LXddhUKxpKTi27e3snMlkyqhSCcVikRyOz1UeFJEvApvpZWy6PDRKTxJFpOlny7IgCAIURYEoSQSjUiQE75JcLncYuOQXvAMD7uwCW/YPAoaRlHXwPA+TYMxJOMxjbX0DwVAYadOAqqlY8wdgpu0DIIn78nWFncoOCwR0/NjKJghERZdl2I4Dm6WoqgRJkds0TLrANE1IyfJ7BmLLc/h9PYQSBZ7DPJCzlpBzgpSiSq7ClLoOlcAsTVlWvH1leQVyUkQkEsO3xUWCugfABN1WrACZw2234tB0kEwmvY+ZGxYzIKtZoVDAzs7OvvL5/AEwQB/tAXfzrCkr5DAEWTHIQZhSp+ZQIyKRKOLxhAf71/KAkqodArKmbGWj5EYnQJwaYtLYOIjHogjyEWpUhOqpeI1il/hpZhVilBtLTVG0PWAJBRqb7QxPQBqXNE1+SqM5y3qFN2hEVG/2LLh0ZrPJGsRq6rjuAVCuAA9P/P8txvkL/uNLqQsdAo4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Registry Editor\"\n        title=\"\"\n        src=\"/static/87791a29882b11a34ebbf788ee275572/4f5b3/registry.png\"\n        srcset=\"/static/87791a29882b11a34ebbf788ee275572/cde50/registry.png 148w,\n/static/87791a29882b11a34ebbf788ee275572/4f5b3/registry.png 291w\"\n        sizes=\"(max-width: 291px) 100vw, 291px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n</li>\n<li>\n<p>HKEY (handle to a key). Most important are <code class=\"language-text\">HKEY_USERS</code> (HKU) - profile of users, <code class=\"language-text\">HKEY_LOCAL_MACHINE</code> (HKLM)</p>\n</li>\n</ul>\n<h4>Timeline Analysis</h4>\n<ul>\n<li>$MFT (master file table) - check timings of when things are changed\n<code class=\"language-text\">volatility.exe -f nameofmemorydump --profile=Win7SPOx86 mftparser --output=body &gt;&gt; mftparser.txt</code></li>\n<li>Reg-Ripper</li>\n<li>Volatility timeline\n<code class=\"language-text\">volatility.exe -f nameofmemorydump --profile=Win7SPOx86 timeliner --output=body &gt;&gt; timeline.txt</code></li>\n</ul>\n<h4>Files and Directory Analysis</h4>\n<p>Things to check:</p>\n<ul>\n<li>pagefile.sys, index.dat, etc</li>\n<li>Windows event logs (Application, System, Security, DNS)</li>\n<li>IIS/webserver/FTP logs/URL Scan - the web could be a point of entry</li>\n<li>Windows firewall log (%windir%\\pfirewall.log)</li>\n<li>setupapi.log - installation of applications and devices</li>\n<li>schedlgu.txt - scheduled tasks</li>\n<li>Application configuration files and logs</li>\n<li>Antivirus/IDS/IAS/ISA Server logs</li>\n<li>Prefetch folder <code class=\"language-text\">strings C:\\WINDOWS\\Prefetch\\PWDUMP2.exe</code></li>\n<li>Evidence of malware, rootkits, etc</li>\n<li>System restore points</li>\n<li>Hybernation file</li>\n<li>Crash-dump files</li>\n<li>LNK files</li>\n<li>Shell-bag - when you open a window</li>\n<li>HKEY_USERS for internet browsing history, last accessed files</li>\n<li>Autorun locations</li>\n<li>MRU lists</li>\n<li>UserAssist</li>\n<li>USB devices</li>\n<li>Geolocation</li>\n</ul>\n<h4>Data Recovery</h4>\n<ul>\n<li>When you delete files, the markers in memory for the data are deleted, but not always the data</li>\n<li>You can use a program to search for the data such as PhotoRec. Header files start with certain keys, so it looks for starting with JOJA and footer has xyz.</li>\n</ul>\n<hr>\n<h3>Lab</h3>\n<p>We are then given a challenge, a Korean defector was caught with a USB stick that we need to investigate.</p>\n<p>First I mounted the contents of the drive to a drive on my VM using OSFMount:\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/55db41f0441e2e74076a184508eda16f/6e3a5/1-mounted.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 19.888475836431226%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsSAAALEgHS3X78AAABD0lEQVQY0yWOW0sCYRCG9xd2pOwmEwJDiLIuRCK6CCLoOiShm4KILoL+QD8hqMxSk4KV1XVb3fO3J5anz3VgeOeZeWcY5fb+kbuHJy6bN9ROLtitnbJXP6NYPmRlY5tCscJO9Zjq0Tlb5QMW14osF0osrZdyXVjdpLJf56pxzXOzgfLy+kGr3aH92aX3/Uu394M+NgmjFBHGBCLGDyKpkeQk51nO5nNPgusJzKmL4QiUr04HbTik3++jaRpjw+DPNLEsW6aFZduYkke6zmikE4YhU9kfDAaoqspkMkGXM0Pu2bKvvL23yLIMx3HwPA8hhFQ/r13XJYrkd0GQs+8HzCJJ5FfunNM0lZ44vxHHMf/B5BL0uFCssAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Contents of USB\"\n        title=\"\"\n        src=\"/static/55db41f0441e2e74076a184508eda16f/fb8a0/1-mounted.png\"\n        srcset=\"/static/55db41f0441e2e74076a184508eda16f/1a291/1-mounted.png 148w,\n/static/55db41f0441e2e74076a184508eda16f/2bc4a/1-mounted.png 295w,\n/static/55db41f0441e2e74076a184508eda16f/fb8a0/1-mounted.png 590w,\n/static/55db41f0441e2e74076a184508eda16f/526de/1-mounted.png 885w,\n/static/55db41f0441e2e74076a184508eda16f/6e3a5/1-mounted.png 1076w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/77ce83f124f5f45d668d35413d4e5e2a/ab1f1/1b.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 44.90909090909091%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABrklEQVQoz4WRz07bQBDG/XSoqkSrFEgrQlS4wLmXXhBHWsEJbly58wJ9gp44AaoK+YNZL3bsrO1d25s4tvk6uwEaJCQsfZrdmdnffCM73w9P8W33B/YOT9Bqd7H0/iOWW2201jpY39zB+tdtrHW28Km9Mddnoy5WvnTxYaWDd8ur6Gzt4Of+Ac6Oj+D8+n2Ji2sPV30flz2Ov26IPwMffS8GFxN4Yw03UBjwBMP7FEN/LjeQ6FOu5wlcuxEuej7OexEc3+cIRiGUyiDSDEmqkCQpRJxASmXzZTlDnEhbK/QEknKa4pTyRUFxWqJuHig3hcPvGbJM0UUjiEZgHsMd8xBFY2rW0BPzsIQQMcZCEEzRsJjg0g7K8pze52iahsAEvLll5HBkJ4YhARmzDmggZrMKs6q2TgwsGgukBDJw+ehcEcxADXBCTp0B40iltE7CwIeSKTXSCnVNquaxquwGWhfWhS6K556ynNpzQ2cL5H5Iq+XI88JONV9FgBeycBK5MLF5jKZWP9WegLe08ohWNauYn9A0/xsX42tarD0DXeZiMByCc27XeW3yW1oE/gMt/ZIfmgcVHQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Contents of USB\"\n        title=\"\"\n        src=\"/static/77ce83f124f5f45d668d35413d4e5e2a/fb8a0/1b.png\"\n        srcset=\"/static/77ce83f124f5f45d668d35413d4e5e2a/1a291/1b.png 148w,\n/static/77ce83f124f5f45d668d35413d4e5e2a/2bc4a/1b.png 295w,\n/static/77ce83f124f5f45d668d35413d4e5e2a/fb8a0/1b.png 590w,\n/static/77ce83f124f5f45d668d35413d4e5e2a/526de/1b.png 885w,\n/static/77ce83f124f5f45d668d35413d4e5e2a/fa2eb/1b.png 1180w,\n/static/77ce83f124f5f45d668d35413d4e5e2a/ab1f1/1b.png 1650w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Next I used the Google Translate app on my phone to take a picture of the files and translate them:</p>\n<ul>\n<li>Democratic People’s Republic of Korea - country to.mp3</li>\n<li>Target list.zip</li>\n<li>Rootkin.bin</li>\n<li>Target.bat</li>\n<li>Goal.png</li>\n</ul>\n<h5>Targets</h5>\n<p>Looking at the contents of the jpg file as strings, I found the password:\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/407d57d1c0dff5f0b58283721bc98cc5/02562/3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 52.22078482104355%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAACUUlEQVQozzVSWU8aURSeX9nEVlEQg7XbW9M+9ql9aOxrE0lMFAGNCyJENoelUZZhFgYGlHWgLLaVNqlBKmq+nnvVm3w5833n3C/nnDuC8+sKPnz6jDn7a8wtvITVvohZ2wKs8w5Mz9oxY3WQtgTbwgs8tczDMr8Ex6u3mJq24cnUDEUrnlnsWHz+Bh/fv4OglzToSgrpnA61dIpisYhSqYRWq4mzWp1rmnHGUShXoRFXixX+rVfqKBikVWpQD0SkfVEIYuIbTnIaMpJMUBA8DGN9fR2RWAz7/gO4PB5seD3wbm3BQ9je3YV7c5Nz5+oq3F4vNqjGueLExtoahFarhavxGLd3d5hMbmCabYRCIciyjHa7jcFggF63iy6h0+k88B46lGs0GmgSTPJgPv1+H8Jw+JuMJrgjQ3aYmEqlkM1mYRgGN1ZVlUdFUfg6GFg+k8lA1TRUqzVqxMTFxRDC8fExqrUams0mTk9pX1TAOtze2UY8HucmLGe2TJ7P5/O8pl6vc67rOsrlMhr1BmrkI/j8QWRyMsRECjt7fiSSKUQiEbjdbix/WcYa7SUQCMDlcnGd4YD4YegQ0WiU8yPxiHPWtTA4/4HxvwlGV2M+skm7kXI5SJIEn28P4XCYoo8uhvmoJ+kTBIMBBAh+/z5EUeRTMPNkMglhPL43ejxGuYJwLI50VoGs6sgrOhStSLGArHSvabrxgDLPSbLGo1ooQWAPcnl5yTEajdDufMev4R8Mzn/yRbMJuvSqvV4fVzTFze0trunONf0RDJMHMP0vefwHe2WYwkxF0g0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Password found\"\n        title=\"\"\n        src=\"/static/407d57d1c0dff5f0b58283721bc98cc5/fb8a0/3.png\"\n        srcset=\"/static/407d57d1c0dff5f0b58283721bc98cc5/1a291/3.png 148w,\n/static/407d57d1c0dff5f0b58283721bc98cc5/2bc4a/3.png 295w,\n/static/407d57d1c0dff5f0b58283721bc98cc5/fb8a0/3.png 590w,\n/static/407d57d1c0dff5f0b58283721bc98cc5/526de/3.png 885w,\n/static/407d57d1c0dff5f0b58283721bc98cc5/fa2eb/3.png 1180w,\n/static/407d57d1c0dff5f0b58283721bc98cc5/08f6a/3.png 1770w,\n/static/407d57d1c0dff5f0b58283721bc98cc5/02562/3.png 2319w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Which I used to unzip the zip file:\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a86b08d31715bef6501959cc0c6ac298/511d6/4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 20.64404830362277%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA/UlEQVQY002OuU7DUBBF/ak0FCRpIICQMChIIERDgYTYREdBR0GH4AsQBVUQMYiQzbKf/bw887wlB8cFpLiamTN3FuP2/pHrmzu2949ZWtlkublFY9WktbFHc71Da1EVq3m7Q2Ntl7Z5xM7hGebBCeenlzxcXWC8WK+89fp8jm0+vscMrAHOsE9WlBTFjLyYLmhGlpe15nWaFaRpTpJoZBDjhglG13rnazhmNJogfR8pJY7jYE9sXFfgV0wI8cejKKpzITzCMKx7XuVRSqHiGOO5J3jqhvgqJ8tSkh+N1rpa5uJVQ1IGeJ5PEAT1AaWSyjf/6j9qnZLnBWU55RdLNRZPK4ZqSAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Unzipped file\"\n        title=\"\"\n        src=\"/static/a86b08d31715bef6501959cc0c6ac298/fb8a0/4.png\"\n        srcset=\"/static/a86b08d31715bef6501959cc0c6ac298/1a291/4.png 148w,\n/static/a86b08d31715bef6501959cc0c6ac298/2bc4a/4.png 295w,\n/static/a86b08d31715bef6501959cc0c6ac298/fb8a0/4.png 590w,\n/static/a86b08d31715bef6501959cc0c6ac298/526de/4.png 885w,\n/static/a86b08d31715bef6501959cc0c6ac298/fa2eb/4.png 1180w,\n/static/a86b08d31715bef6501959cc0c6ac298/511d6/4.png 1739w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>And read its contents, the list of targets! (included S-Oil Onsan Refinery, GS Caltex Yeosu Refinery)\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f0ec9196d316c5129de247ce423f8f06/34f25/5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 8.734939759036143%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAiElEQVQI1yWLyw7BUAAF+8u0VRVVRGJLrldUNVa+x94HWCK9r+rNuOoks5nMCYrqykocEfszYleyPVSsNwXxaE44nBKlM2JPmOQdkXdpviQZL+gPMs+EXpx1zam4ENzuD4ySSKWRUvF8valrSdN8UFpjjMFYy2/OOdrWoX2rvZdKYW3zb4ztvl+RvYCnwaVvcQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Opened file\"\n        title=\"\"\n        src=\"/static/f0ec9196d316c5129de247ce423f8f06/fb8a0/5.png\"\n        srcset=\"/static/f0ec9196d316c5129de247ce423f8f06/1a291/5.png 148w,\n/static/f0ec9196d316c5129de247ce423f8f06/2bc4a/5.png 295w,\n/static/f0ec9196d316c5129de247ce423f8f06/fb8a0/5.png 590w,\n/static/f0ec9196d316c5129de247ce423f8f06/526de/5.png 885w,\n/static/f0ec9196d316c5129de247ce423f8f06/fa2eb/5.png 1180w,\n/static/f0ec9196d316c5129de247ce423f8f06/08f6a/5.png 1770w,\n/static/f0ec9196d316c5129de247ce423f8f06/34f25/5.png 2324w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h5>Malware</h5>\n<p>Looking at the strings of the .bin file, we see <code class=\"language-text\">cmd.exe /q /c net share shared$=%SystemRoot% /GRANT: everyone, FULL</code>\nIt looks like it is executing a command to create a network share to the system root and give full permissions to everyone. /q is for quiet mode so it’s undetected.</p>\n<p>Googling some other strings in the Malware, I came across led me to searching for “dpnsvr16” which took me to a <a href=\"https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?name=win32/nukesped\">Microsoft page about a specific malware</a>. This page says that the malware copies itself using a filename such as dpnsvr16.exe. I see other similar strings appear in this malware, such as “igfxtray.exe”, “net_vevr.dat”, so I think it’s the same malware. Finally, at the end of the article, I click on a <a href=\"https://www.reuters.com/article/us-sony-cybersecurity-malware/exclusive-fbi-warns-of-destructive-malware-in-wake-of-sony-attack-idUSKCN0JF3FE20141202\">link</a> that it references for more information, and learn that it’s the same malware that infected Sony, so I think I found it!</p>\n<h5>Deleted files</h5>\n<p>The following files were deleted (found using PhotoRec):\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/44adaa83cacd14a017263fe5ccade7cf/a7964/2-photorec.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 37.025796661608496%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAAA+UlEQVQoz31R2W6EQAwDcd9XgeUUCIEE4nrY/v+nufJUs+pDdx+szCiJHSfK8/mN8zyxriuu68JxHNj3Hfd9Y1kWbNuGYRgwTRO6roPrulAU5T2apkEURciyDH3f4/F4oCgKAdu2YRgGVFWFpmmfiSSy7At1XQuCqqrg+z4cxxECcRyLqSjIYk7HN0WYI9I0RRiG0HX9l1DTdNGc5/m/U0gB5pIkEbWcXDoqyxJt24ooeoIgEIqmab4sep73IvoL1jBalvXe8jzPwvI4juIIVKIICdlIEVrin5Zp8+Nhuq4X+yMprynfPA7XQCFGQu6MOUa5Kg5B+xT6AdMoo3BPwEyuAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"PhotoRec\"\n        title=\"\"\n        src=\"/static/44adaa83cacd14a017263fe5ccade7cf/fb8a0/2-photorec.png\"\n        srcset=\"/static/44adaa83cacd14a017263fe5ccade7cf/1a291/2-photorec.png 148w,\n/static/44adaa83cacd14a017263fe5ccade7cf/2bc4a/2-photorec.png 295w,\n/static/44adaa83cacd14a017263fe5ccade7cf/fb8a0/2-photorec.png 590w,\n/static/44adaa83cacd14a017263fe5ccade7cf/a7964/2-photorec.png 659w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e8a807dd7bb7eb6705ec5cccd926b26e/214b2/2a.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 47.423887587822016%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABMUlEQVQoz22S2ZaCMBBE+f/fm4fhyLCIHgFBIWFfa1Jx2qMOD6GbpFN9K4lTXGIEPx6O8Qm32w1t26Jpmueo6xp5UeB6zZHnOaqqsrEwc9qssUZrjSzL0Pc9HKULeN7BDM9uXpYF8zw/xzRNuN/vthkjGzKK6DAMtq4sy4dgrjSCKML5fDKL41OQUXISlIaMmyhISs5JU9Yppay4k51DHKMAsbFMwnVd3woZlaqsIDeRovoTl6Z0wblxHA1h8AX/8I3oGJsz0buC3Pxp+VNQ7Dtt2+CSJEiS1E68nuGrZdIxsoZOJJcaXo4lpIUwDOH7vi36T/i4FBLIK2CkgBAyT9MHkMMPfxJD2XXdLqEQMQqh0HGQjOuWkAukc13XvLUrtm17F9x5Nsx5BNKQrngpdPsLMjqz67qKpF0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Recovered files A\"\n        title=\"\"\n        src=\"/static/e8a807dd7bb7eb6705ec5cccd926b26e/fb8a0/2a.png\"\n        srcset=\"/static/e8a807dd7bb7eb6705ec5cccd926b26e/1a291/2a.png 148w,\n/static/e8a807dd7bb7eb6705ec5cccd926b26e/2bc4a/2a.png 295w,\n/static/e8a807dd7bb7eb6705ec5cccd926b26e/fb8a0/2a.png 590w,\n/static/e8a807dd7bb7eb6705ec5cccd926b26e/214b2/2a.png 854w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    \n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2b0d69a3aa4c4a034dac4f125a529f91/29454/2b.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 39.0452876376989%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAABHklEQVQoz22S25KDIBBE+f+fVMzilhdEwLumOvSspFKpfegSxslxuidqig5aa+hKY14WPJ9PnOf51nVdmOcZwzBgHEf4ELCuK5xzWFL/vu9/fUnTNEEFp1GWGlVVSRMB/wFtAvI9odu2wVqLPqnrOhzHkeCznFX0Bo/HD4wxUiCAU2Ywn5yEMO89QpqQwAznk0DWeJcJi6JMKgTatI18PcYoMIpW+r6XH1O0zAgo1gmkeFfBNwKihsFKJrnhvIGS4T0hlTPMU9MJ+3lWDLlKSzGmlmK2+2n5cynhXkq2S6s5JtbVb2dly0VZpvHtG/K9FC4gT8RMmTfPW3JEWIxB7KvejajrGm3bSm60/A3kBjOMPbIk/oXSnR9jDyfluxc5iWa13eH4rAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Recovered files B\"\n        title=\"\"\n        src=\"/static/2b0d69a3aa4c4a034dac4f125a529f91/fb8a0/2b.png\"\n        srcset=\"/static/2b0d69a3aa4c4a034dac4f125a529f91/1a291/2b.png 148w,\n/static/2b0d69a3aa4c4a034dac4f125a529f91/2bc4a/2b.png 295w,\n/static/2b0d69a3aa4c4a034dac4f125a529f91/fb8a0/2b.png 590w,\n/static/2b0d69a3aa4c4a034dac4f125a529f91/29454/2b.png 817w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h5>Username/passwords</h5>\n<p>After opening a file recovered via PhotoRec, I searched in the .bin file for the string ‘spe’ (lecture hint) and found the following (at offset value 0x3ebbd):</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f95e466da5c2bd0bbcd609d4ccf11ffc/bd485/6.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 50.32453483340545%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAACL0lEQVQoz22RW08acRDF93NataJSb2nSN/sJmr71oUnTh/atiVoNTVoJ1guCVBEqCCwLKlor12Vxl0sCgcXw6+ymJKbpJCdzZnZmcv5nlY/vP/D6zVtmZpd5OreMZ36JOe8i3sUVPN4lJme8zC8+Z/bZChPTc8x4V1h+8ZJpzwJPpmaZlN7ElIcFmXm1uoqSUtNkzsPEzzKcqxdktTy5nMZlPo+maiRTWdJqnnQmRyZ7QUpyKp11c8JBWiD9+Nd9jjcDKKFwhOjPFLGzJKfxBPvBEMlEko1tP++2tvi0u8tGOMza4SHrwSCboRDrUvsiR4QFoUhEIPzoiOD+AcrNzS+63S6jEbTbbVGjYfe6aO0OX+oG2zWd7+UKO6USO+UygcY9gXqdmGXxbzw8PKDUjQa2PZCDI3q9HqqWo22ZpGXRVyrzTQ7574r4i0UCgh1dZ7tS5dgwsAcDBoL+3+wIU6LRKIVCgdvbWwpXV5zGYpwl0iTUHCcplaj4dZJxoLk8Ji+IZnMuz+bE8/wl2sUV+ctrNOHK2mcf4R+n7B2E2dj04Q/scX3zm2qlwr2oN0RRvVajJqoMsUCvVtGFl4slqsLvRL0hc7rMtVptlFKljmk1RbaN2Mi9aWEKdDlimiaNRsOFs9RsNl1uWpb7zamd7Hjv9Dudjhws16TREkOHrrGGeNNqtej3+64vw+HQzbZtuz6Pw6Hj2sljKEX3YNv9Q05U5DktqUf8P8aLj+vH8QdtRruELp3jjgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Usernames and passwords\"\n        title=\"\"\n        src=\"/static/f95e466da5c2bd0bbcd609d4ccf11ffc/fb8a0/6.png\"\n        srcset=\"/static/f95e466da5c2bd0bbcd609d4ccf11ffc/1a291/6.png 148w,\n/static/f95e466da5c2bd0bbcd609d4ccf11ffc/2bc4a/6.png 295w,\n/static/f95e466da5c2bd0bbcd609d4ccf11ffc/fb8a0/6.png 590w,\n/static/f95e466da5c2bd0bbcd609d4ccf11ffc/526de/6.png 885w,\n/static/f95e466da5c2bd0bbcd609d4ccf11ffc/fa2eb/6.png 1180w,\n/static/f95e466da5c2bd0bbcd609d4ccf11ffc/08f6a/6.png 1770w,\n/static/f95e466da5c2bd0bbcd609d4ccf11ffc/bd485/6.png 2311w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>","frontmatter":{"title":"Thoughts on Forensics (Defense of the Dark Arts)","date":"January 18, 2019","tags":["school","security"]}}},"pageContext":{"slug":"/security-forensics/","previous":{"fields":{"slug":"/security-malware/"},"frontmatter":{"title":"Thoughts on Malware (Defense Against the Dark Arts)","tags":["school","security"]}},"next":null}}