{"data":{"site":{"siteMetadata":{"title":"Thoughts on Things","author":"Michele Larson"}},"markdownRemark":{"id":"ea6ffb1f-ab7a-594a-94c8-9615384afbc4","excerpt":"This week focuses on life as a malware researcher and covers how the attack gets into the system, how it typically functions, and how we can defend against it…","html":"<p>This week focuses on life as a malware researcher and covers how the attack gets into the system, how it typically functions, and how we can defend against it.</p>\n<h4>Spreading malware</h4>\n<h5>First contact - Possible Sources</h5>\n<ul>\n<li>Email, Instant Messaging</li>\n<li>Malvertising - contaminated ads</li>\n<li>Poisoned search results - Trow up sites based on google trends that would show up high in search results that people would then click on</li>\n<li>Watering hole - go to the place where people mostly go and poison one place</li>\n<li>Physical access - such as USB drives</li>\n</ul>\n<h5>Local Execution</h5>\n<ul>\n<li>Autorun - Windows will automatically run software</li>\n<li>Exploitation of a document or file - PDF, plugin, browser</li>\n<li>Reverse psychology/social engineering - “don’t click here” “click to claim your prize”</li>\n</ul>\n<h5>Establish Presence</h5>\n<ul>\n<li>Tries to blend in and hide (change filenames or datetime stamp, sign files)</li>\n<li>Tries to appear legitimate</li>\n<li>Persists (system startup, application start up, scheduled tasks, etc)</li>\n</ul>\n<h5>Attack</h5>\n<ul>\n<li>Harvest information</li>\n<li>Phone home - use web, email, FTP to send data</li>\n</ul>\n<h4>Defenses</h4>\n<ul>\n<li>User education</li>\n<li>Block computer ports</li>\n<li>Anti-virus/malware</li>\n<li>Network Firewall/Inreusion Prevention</li>\n<li>Message/Network/Web Reputation</li>\n<li>Host Firewall</li>\n<li>Host IPS</li>\n<li>Access control</li>\n</ul>\n<h5>Anti-malware features</h5>\n<ul>\n<li>File Scanning</li>\n<li>Registry and Cookies</li>\n<li>Cloud scanning</li>\n<li>Memory scanning</li>\n<li>Scripts</li>\n<li>Heuristics</li>\n<li>Decomposition</li>\n<li>Configuration: Exclusions, sensitivity, reporting</li>\n</ul>\n<h4>Yara</h4>\n<ul>\n<li>language that lets you search for patterns in your scans</li>\n<li>strings - <code class=\"language-text\">&quot;in quotes&quot;</code> params: <code class=\"language-text\">nocase</code>, <code class=\"language-text\">wide</code>, <code class=\"language-text\">wide ascii</code>, <code class=\"language-text\">fullword</code></li>\n<li>Byte patterns (hex strings) <code class=\"language-text\">{}</code> params: <code class=\"language-text\">?</code> <code class=\"language-text\">??</code> are wildcards <code class=\"language-text\">{E2 34 ?? C8 A? FB}</code></li>\n<li>conditions are boolean operators, arithmetic, and bitwise <code class=\"language-text\">($a == 6 or $b)</code> <code class=\"language-text\">#a == 6 and #b &gt; 10</code> <code class=\"language-text\">$a at 100 and $b at 200</code></li>\n</ul>\n<p>example:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">rule myRule {\n    strings:\n        $a = &quot;win.exe&quot;\n        $b = badfile1.exe\n        $c = badfile2.exe\n    condition:\n        $a and ($b or $c)\n}</code></pre></div>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d6c8310b7e03f48b679c26b2f70516c0/26c84/yara.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 49.33554817275748%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABS0lEQVQoz32S666CQAyE8YoX5CKKKIpX1BA1vP/L9fhNssYTjT8mu9m20+lsvaZp7Hg82ul0srqu7fF42G63s8vlYtfr1RaLhY3HYxuNRjo9z/uN7XYrgvl8bv1+37rdrgK9Xk9kWZYptlwubb1e22q1siRJ9N7pdD4JB4OBRVGkBE6XxPv5fJZySCCrqkrg7XA4GGImk8l/wjCMXqrewYhYgXpIhsOh8lqtlrXb7dcUH7V0CIJAcIkAgs1mI2W3201q8jwXmII4wCam4S6Pi2dB/vRqv98r6AjpTvF0OhUxHmJLURRqkqaplWUpn8lDkAh935fp+BXHschQSleIKMQvfKRwNpupObm8kQMpjeHx8CoMQ/0coBMkWEEhKjjx0t0hY4Kva8PPfgui8H6/azc52Ve3Wu6DvhIy8vtnOFCAZ24URkU5U/xa7D+P7+oXt1IKBgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Yara\"\n        title=\"\"\n        src=\"/static/d6c8310b7e03f48b679c26b2f70516c0/fb8a0/yara.png\"\n        srcset=\"/static/d6c8310b7e03f48b679c26b2f70516c0/1a291/yara.png 148w,\n/static/d6c8310b7e03f48b679c26b2f70516c0/2bc4a/yara.png 295w,\n/static/d6c8310b7e03f48b679c26b2f70516c0/fb8a0/yara.png 590w,\n/static/d6c8310b7e03f48b679c26b2f70516c0/26c84/yara.png 602w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </span>\n  </a></p>\n<p>————</p>\n<p>Lab:</p>\n<p>Consider each sample in\nC:\\Users\\Admin\\Desktop\\malware\\Malware Defense\\Class1\\Sample Group 1\nWrite a single Yara rule to cover all samples and no other files in the  system directory:\nyara-2.1.0-win32\\yara32.exe -p 10 -a 5 &#x3C; rule1 >.yara\nc:\\windows\\system32</p>\n<p>look for yara editor\nRight click on any samples and click “inspect” to dump the strings into the inspector window or can click “send to” to send it to file insight.\nScan code, look for strings that look uncommon. Registry keys, websites, domain, IPs.</p>\n<p>Look for unusual commonalities between groups. </p>\n<p>keyGen + something else</p>\n<h4>Cuckoo</h4>\n<ul>\n<li>Automated analysis - You tell it what VMs to run and when you upload a sample, it will run it on the VMs and report the results.</li>\n<li>The host controller of Cuckoo tells each VM how to run the file. It will create the process, inject its DLL into the process, and then trace the Win32 API calls which then it can report back.</li>\n<li>It also reports files being created, deleted, and downloaded by the malware; memory dumps of the malware processes; network traffic trace; screenshots of Windows desktop; full memory dumps of the machines</li>\n</ul>","frontmatter":{"title":"Thoughts on Security Defenses (Defense of the Dark Arts)","date":"January 26, 2019","tags":["school","security"]}}},"pageContext":{"slug":"/security-defenses/","previous":{"fields":{"slug":"/security-forensics/"},"frontmatter":{"title":"Thoughts on Forensics (Defense of the Dark Arts)","tags":["school","security"]}},"next":null}}