{"data":{"site":{"siteMetadata":{"title":"Thoughts on Things","author":"Michele Larson"}},"markdownRemark":{"id":"9a4af757-d998-5dcc-99ca-c49607aaba72","excerpt":"95% of malware is sent over the web! üò≥ Injection Points De-obfuscated Content ‚Üí Browser/Extensions JavaScript ‚Üí Script Engine HTML (Dom Tree) ‚Üí Browser‚Ä¶","html":"<h4></h4>\n<p>95% of malware is sent over the web! üò≥</p>\n<h4>Injection Points</h4>\n<ul>\n<li>De-obfuscated Content ‚Üí Browser/Extensions</li>\n<li>JavaScript ‚Üí Script Engine</li>\n<li>HTML (Dom Tree) ‚Üí Browser/Extensions</li>\n<li>HTML (Raw HTML) ‚Üí WinInet ETW/ETL</li>\n<li>HTTP ‚Üí HTTP Proxy Network Layer</li>\n<li>Users ‚Üí Social Engineering</li>\n</ul>\n<h4>User Attacks</h4>\n<ul>\n<li>Direct a user to install malicious content on their own - executables, browser exploits, malicious forms</li>\n<li>Phishing - fake website, can get users to enter information on their own, valid SSL cert does not always protect the user</li>\n<li>SEO Poisoning - identify search engine trends, game the relevance results to get malicious site to show up high in results</li>\n<li>Fake AV/Fake Updates - look like security updates and may be designed to look like well known security brands</li>\n<li>Social Media Link Insertion - URL shortening services or URLs that look like another well known site but are made of different letters (rnicrosoft.com) make suspicious URLs look legitimate; Catfishing</li>\n<li>Malvertising - advertising networks can deliver malicious ads</li>\n<li>Waterhole attacks - targeting developers. Can hack a resource known to be used by developers.</li>\n</ul>\n<h5>User Attack Defenses</h5>\n<ul>\n<li>URL/Domain Reputation Systems</li>\n<li>Site Certification Services</li>\n<li>Client and Gateway AV/AM</li>\n<li>Safe URL Shorteners</li>\n<li>Content provider education</li>\n<li>End user education</li>\n</ul>\n<h4>Browser</h4>\n<h5>Security Features of Browser</h5>\n<ul>\n<li>Content Security Policy - Same Origin Policy (DOM, XMLHTTPRequest, Cookies, Flash, Java), Cross Origin Resource Sharing (CORS)</li>\n<li>URL Scheme Access Rules</li>\n<li>OS Isolation/Sandboxing</li>\n<li>Redirection Restrictions</li>\n<li>Content handling/sniffing</li>\n<li>Disruptive Script Handling</li>\n<li>Built-in and Plug-in URL Reputation Client</li>\n<li>Add-on AV/AM Content Monitoring</li>\n</ul>\n<h5>Browser Exploits</h5>\n<ul>\n<li>Browser downloads, renders, and executes malicious web content</li>\n<li>Exploits vulnerabilities in the browser</li>\n<li>Obfuscates the code</li>\n<li>Man in the middle attack - intercepts and modifies traffic in real time; DNS poisoning, Wifi hacking, ARP attack, Rogue or infected router; HTTP can be intercepted and the content rewritten on both proxy and packet levels</li>\n<li>Man in the Browser -  same as MiTM but from within the browser; can be infected by browser exploit, plug-in exploit, HTML5 features such as web sockets/web workers</li>\n<li>DNS spoofing - DNS server returns malicious IP and browser fetches content from it</li>\n<li>Clickjacking - trick user into clicking link in HTML, can be ‚Äúhidden‚Äù and the user doesn‚Äôt realize they‚Äôre clicking it</li>\n<li>SQL Injection - submitting SQL code through a form that can cause harm to your database, circumvent authentication, or read private data; some SQL servers can have access to other things too such as shell commands</li>\n<li>Same origin policy attacks - when a different domain requests something from a different origin, there needs to be a permission check to protect users</li>\n<li>Cross site scripting (XSS) - inject client-side scripts into other user‚Äôs browsers; example - using url params to inject scripts that will run</li>\n<li>Cross-site request Forgery (XSRF) - exploit server‚Äôs trust in the browser; example - authenticated user is trusted, trick browser into sending requests to the site</li>\n</ul>\n<h4>Classifying URLs as malicious or not</h4>\n<h5>Toolbox</h5>\n<ul>\n<li>Alexa ranking - if been in ranking for a while it‚Äôs probably ok, since malicious sites will pop up and down quickly</li>\n<li>archive.org - can check site changes over time</li>\n<li>IPvoid - IPs change but some bad actors reuse the same ones. Legit sites might have more to deliver content faster to the user; so they may use load balancing, while malicious sites typically only have one IP and no mail server. Some malware could use fast flux to change IPs, but these can be detected because they‚Äôre usually user/consumer IPs. On IPvoid you can check IPs against a list of bad ones</li>\n<li>Checkshorturl - expand a short url into the real one</li>\n<li>Site dossier - tells you general information about a site</li>\n<li>Webutation - you can input the URL to this site and see if it‚Äôs been classified yet as reputable</li>\n<li>Web Inspector - you can input the URL and it will run some tests for you and see if it‚Äôs been classified as malicious already</li>\n<li>Virus Total - search for URL and this tool scans it. A way for security researchers to share info.</li>\n<li>Linux JWHOIS - provides information about domain registration. The info malicious users input for domain registration can be reused or they may put in fake data that can be detected.</li>\n<li>Linux DIG - checks if DNS resolves</li>\n<li>Indicator of Compromise - from logs you can see patterns of malicious objects such as URL, hash, process id, etc</li>\n</ul>\n<h5>Research tools</h5>\n<ul>\n<li>PhantomJS - headless webkit/browser, use by rendering the content of pages automatically and then try to determine if it‚Äôs malicious</li>\n<li>JSUnpack - de-obfuscates scripts and detects exploits/browser plug in vulnerabilities</li>\n<li>Burp Suite - can act as a proxy to intercept traffic, can follow links linked within the website (spidering)</li>\n<li>Webscarab - also can intercept and modify requests (very similar to Burp Suite)</li>\n<li>Firebug - gives you ability to inspect elements, modify DOM in the browser for Firefox</li>\n</ul>\n<h5>Content based classification</h5>\n<ul>\n<li>Manual - a person goes and looks at it manually (time consuming, only used when it‚Äôs really important). Make sure you document everything and store the content! (it may disappear)</li>\n<li>Static - get the page and scan (not render)</li>\n<li>Low Interaction - PhantomJS or similar, where it‚Äôs rendered but no human involved</li>\n<li>High interaction - malicious actors can detect you using a web kit, or they could delay the malware from being loaded, which will cause these fast techniques to not detect it. You have to make high impact sandboxes that looks similar to the environment where it would be running on, to bypass any of these tricks.</li>\n</ul>\n<h5>Lexical URL classification</h5>\n<ul>\n<li>Classify a URL without looking at its content (the content may not be available, crawling URLs takes a long time, there are things we can look at without having to do this)</li>\n<li>Can use human authored rules or machine learning or both!</li>\n</ul>\n<h5>Host URL classification</h5>\n<ul>\n<li>Check info about the host: IP addresses, DNS data, Domain registration</li>\n</ul>\n<h5>Graph based URL classification</h5>\n<ul>\n<li>Graph databases, make it faster to search and find</li>\n</ul>\n<hr>\n<h4>LAB</h4>\n<p>Web Goat is a web server you can run in a VM without internet connections. It contains lessons of insecure practices, so we can practice on it.</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/79dbca72fcf184ef77a4ef1234cbc58b/a772f/a.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 72.62845849802372%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAADB0lEQVQ4y3VTyW7TUBT1dyCxRYhBgg0SUISqSnwMgxgFC6ACfqGwYt6xBFUMG5ZMbUISZ2paSkISvySeZzuDfTh2SQEhnBzd+/z8js8991qSKxU0azXUq1XUKmW0GnU0mJeLX1EpF1FY/5TnpUIhR12W8+dbjQaazSbq9XqOGu/J3JMUXYdwPQjfh/A8dG0bgyCEOZvBAWCnCZw0hZ2kUKMYakyMx/mzw9EIDZJtbGzkqFKI9OLCORTv3ELx+lWs37iGj1yXr1xG494y6su3UFu+idrd2zvgvead21g/fxYfL17A2LKQXWmSIOVLoyiCdGnvHjxZOIYHRw8Th/DgyEHcP7QfKwf2YYXx4ekTeLS4gEdLp/D0zGk8XTyJx8eP4dmZJdhC7BJmV0z1klws4ruioDccotVu41OphDV6UWm1UMrK2NqCvLmJWhZ5r0zfCvSrwPIiEuSEVJcrjKlwpGkY05NfO4hVFWN6kxgGUvqbcj0xTbiui9l0iulkgsAPELO8nIi//J+dzRQKpQ/fc5GwCdkB0e2i2+4w9qCTWKdyjVHNcr5Ao4AsRmG0q24ecw/bugfVmcKPMx9SjHlgQlVgF+E4O2DnYdlIqXJO8CfZPM8V/lCGsBwPCcdiRpUqyUyW6JHQI8EcWYm/D+dV7no3x5QVSproIrD13bcEQYD/XWEYYhzF2DEt+Wc/Ybelhx86ePJFYEvR6Y0G03agajoGIyq1HIghvTMtrkcolspof9tGq6Ogtt2HzQ/CYPOyATdYlWGYkF6ub+P55x8cmT40pQPX1ODoI9iEZ+l5zGBpQwSOCUwjrG0NsCoPIFSDIgw2ysgFdPsC0hdubigGqj0Tcs/AWsdEeRChMowYw7+iPAzxVfHR1V1OgIBuCAShCz9wYbkO++ZAelXqY7WwjTdVgfcNgXfVPt7IPbxlfF3pMe//Qg+rFQWrDQNNYSFwTTZfg+dbcDybjXW4JmFocUR8DVNXx9TneIy9HUzm0f+dx8wxw4RfxEAoUESbntMWxyZxyAlz8RMKVD1t541svgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Webgoat\"\n        title=\"\"\n        src=\"/static/79dbca72fcf184ef77a4ef1234cbc58b/fb8a0/a.png\"\n        srcset=\"/static/79dbca72fcf184ef77a4ef1234cbc58b/1a291/a.png 148w,\n/static/79dbca72fcf184ef77a4ef1234cbc58b/2bc4a/a.png 295w,\n/static/79dbca72fcf184ef77a4ef1234cbc58b/fb8a0/a.png 590w,\n/static/79dbca72fcf184ef77a4ef1234cbc58b/526de/a.png 885w,\n/static/79dbca72fcf184ef77a4ef1234cbc58b/a772f/a.png 1012w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </span>\n  </a></p>","frontmatter":{"title":"Thoughts on Web Security (Defense Against the Dark Arts)","date":"February 19, 2019","tags":["school","security"]}}},"pageContext":{"slug":"/security-web/","previous":{"fields":{"slug":"/security-network/"},"frontmatter":{"title":"Thoughts on Network Security (Defense Against the Dark Arts)","tags":["school","security"]}},"next":null}}