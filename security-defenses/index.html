<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/blog/component---src-templates-blog-post-js.72dbeacc3950e5605200.css">body{background-color:#1f2232;color:#fff;font-family:Titillium Web,sans-serif;font-size:20px;letter-spacing:.04em}body,h1{font-weight:100}h1{font-family:Lato,sans-serif;font-size:65px;letter-spacing:0;margin:20px 0 10px}a{color:#e3bac6;text-decoration:none}h1>a{color:#fff}h1,h2,h3,h4,h5{padding-top:20px;color:#bc9ec1;text-transform:uppercase;font-family:Lato,sans-serif;font-weight:300}</style><meta name="generator" content="Gatsby 2.0.91"/><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml"/><link rel="manifest" href="/blog/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><title data-react-helmet="true">Thoughts on Security Defenses (Defense of the Dark Arts) | Thoughts on Things</title><meta data-react-helmet="true" name="description" content=""/><meta data-react-helmet="true" property="og:title" content="Thoughts on Security Defenses (Defense of the Dark Arts)"/><meta data-react-helmet="true" property="og:description" content=""/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Michele Larson"/><meta data-react-helmet="true" name="twitter:title" content="Thoughts on Security Defenses (Defense of the Dark Arts)"/><meta data-react-helmet="true" name="twitter:description" content=""/><link as="script" rel="preload" href="/blog/webpack-runtime-ec626fa5275f79d2758b.js"/><link as="script" rel="preload" href="/blog/app-f66cd48d3b7ffec6f559.js"/><link as="script" rel="preload" href="/blog/0-d5b0ae4c4b22ae57f84e.js"/><link as="script" rel="preload" href="/blog/component---src-templates-blog-post-js-874a1cf32e0f30fb274d.js"/><link as="fetch" rel="preload" href="/blog/static/d/613/path---security-defenses-2-a-7-855-8g8wK9S8MKmIIZQF1aZG702t6P0.json" crossOrigin="use-credentials"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div style="margin-left:auto;margin-right:auto;padding:30px"><h1><a href="/blog/">Thoughts on Things</a></h1><h3>Thoughts on Security Defenses (Defense of the Dark Arts)</h3><p style="text-transform:uppercase;font-size:14px">January 26, 2019</p><div><p>This week focuses on life as a malware researcher and covers how the attack gets into the system, how it typically functions, and how we can defend against it.</p>
<h4>Spreading malware</h4>
<h5>First contact - Possible Sources</h5>
<ul>
<li>Email, Instant Messaging</li>
<li>Malvertising - contaminated ads</li>
<li>Poisoned search results - Trow up sites based on google trends that would show up high in search results that people would then click on</li>
<li>Watering hole - go to the place where people mostly go and poison one place</li>
<li>Physical access - such as USB drives</li>
</ul>
<h5>Local Execution</h5>
<ul>
<li>Autorun - Windows will automatically run software</li>
<li>Exploitation of a document or file - PDF, plugin, browser</li>
<li>Reverse psychology/social engineering - “don’t click here” “click to claim your prize”</li>
</ul>
<h5>Establish Presence</h5>
<ul>
<li>Tries to blend in and hide (change filenames or datetime stamp, sign files)</li>
<li>Tries to appear legitimate</li>
<li>Persists (system startup, application start up, scheduled tasks, etc)</li>
</ul>
<h5>Attack</h5>
<ul>
<li>Harvest information</li>
<li>Phone home - use web, email, FTP to send data</li>
</ul>
<h4>Defenses</h4>
<ul>
<li>User education</li>
<li>Block computer ports</li>
<li>Anti-virus/malware</li>
<li>Network Firewall/Inreusion Prevention</li>
<li>Message/Network/Web Reputation</li>
<li>Host Firewall</li>
<li>Host IPS</li>
<li>Access control</li>
</ul>
<h5>Anti-malware features</h5>
<ul>
<li>File Scanning</li>
<li>Registry and Cookies</li>
<li>Cloud scanning</li>
<li>Memory scanning</li>
<li>Scripts</li>
<li>Heuristics</li>
<li>Decomposition</li>
<li>Configuration: Exclusions, sensitivity, reporting</li>
</ul>
<h4>Yara</h4>
<ul>
<li>language that lets you search for patterns in your scans</li>
<li>strings - <code class="language-text">&quot;in quotes&quot;</code> params: <code class="language-text">nocase</code>, <code class="language-text">wide</code>, <code class="language-text">wide ascii</code>, <code class="language-text">fullword</code></li>
<li>Byte patterns (hex strings) <code class="language-text">{}</code> params: <code class="language-text">?</code> <code class="language-text">??</code> are wildcards <code class="language-text">{E2 34 ?? C8 A? FB}</code></li>
<li>conditions are boolean operators, arithmetic, and bitwise <code class="language-text">($a == 6 or $b)</code> <code class="language-text">#a == 6 and #b &gt; 10</code> <code class="language-text">$a at 100 and $b at 200</code></li>
</ul>
<p>example:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">rule myRule {
    strings:
        $a = &quot;win.exe&quot;
        $b = badfile1.exe
        $c = badfile2.exe
    condition:
        $a and ($b or $c)
}</code></pre></div>
<p><a
    class="gatsby-resp-image-link"
    href="/blog/static/d6c8310b7e03f48b679c26b2f70516c0/26c84/yara.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 49.33554817275748%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABS0lEQVQoz32S666CQAyE8YoX5CKKKIpX1BA1vP/L9fhNssYTjT8mu9m20+lsvaZp7Hg82ul0srqu7fF42G63s8vlYtfr1RaLhY3HYxuNRjo9z/uN7XYrgvl8bv1+37rdrgK9Xk9kWZYptlwubb1e22q1siRJ9N7pdD4JB4OBRVGkBE6XxPv5fJZySCCrqkrg7XA4GGImk8l/wjCMXqrewYhYgXpIhsOh8lqtlrXb7dcUH7V0CIJAcIkAgs1mI2W3201q8jwXmII4wCam4S6Pi2dB/vRqv98r6AjpTvF0OhUxHmJLURRqkqaplWUpn8lDkAh935fp+BXHschQSleIKMQvfKRwNpupObm8kQMpjeHx8CoMQ/0coBMkWEEhKjjx0t0hY4Kva8PPfgui8H6/azc52Ve3Wu6DvhIy8vtnOFCAZ24URkU5U/xa7D+P7+oXt1IKBgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    ></span>
    <img
        class="gatsby-resp-image-image"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;"
        alt="Yara"
        title=""
        src="/blog/static/d6c8310b7e03f48b679c26b2f70516c0/fb8a0/yara.png"
        srcset="/blog/static/d6c8310b7e03f48b679c26b2f70516c0/1a291/yara.png 148w,
/blog/static/d6c8310b7e03f48b679c26b2f70516c0/2bc4a/yara.png 295w,
/blog/static/d6c8310b7e03f48b679c26b2f70516c0/fb8a0/yara.png 590w,
/blog/static/d6c8310b7e03f48b679c26b2f70516c0/26c84/yara.png 602w"
        sizes="(max-width: 590px) 100vw, 590px"
      />
  </span>
  </a></p>
<h4>Automated Analysis</h4>
<h5>Cuckoo</h5>
<ul>
<li>Automated analysis - You tell it what VMs to run and when you upload a sample, it will run it on the VMs and report the results.</li>
<li>The host controller of <a href="http://docs.cuckoosandbox.org/en/latest/introduction/what/">Cuckoo</a> tells each VM how to run the file. It will create the process, inject its DLL (randomly named to avoid detection) into the process, and then trace the Win32 API calls which then it can report back.</li>
<li>It also reports files being created, deleted, and downloaded by the malware; memory dumps of the malware processes; network traffic trace; screenshots of Windows desktop; full memory dumps of the machines</li>
</ul>
<hr>
<h4>Lab</h4>
<p>We are given some sample files to analyze using Cuckoo. I chose to write about the last file. First I use the command line to run Cuckoo on the file:</p>
<p><a
    class="gatsby-resp-image-link"
    href="/blog/static/b0c184f694330c10af6d35ceadf9c996/5d9c9/cuckoo.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 96.9230769230769%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsSAAALEgHS3X78AAACjklEQVQ4y3WU13KaQQyF95rQe+8dfprpJBkSxwETD2Mnef9XkffTWAw3vtDsImmPjo7E7za7gzSbTel2e2qdblcq1apEojGJekul0nqPRKL+NIvJl3BEYrG4nuGIWVTc6XyRlgccj8eyWCxkOp1ogVQqJZl0WorFomQyGSmXy5LNZiX7cc/n81KpVCSXy+m9VCpJMpkU9/h0kopPIKnqmWG1Wk2TW62WGgXwcdbrdS2G4dPCvkjaF+d019c3z2oqw9FINpuNLJdLNXyr1Urm87kEQSCz2UyOx6MMh0P93e/39U5n5FIoHo+LOz//UScPYQBD2BYKBWk0GsoCo3XY2kmuxbnTsgJeXq5aHaOKAQAIMI/NV/6QBs2Io58VgwinO3mGk8lEaQPa6/VUP4L3gPgYCkwSiYTqZcPixI+53x7w4WGheq3X65tm7XZbdUKOTqdzmzZGazYI/EyXYnSoDIeDgT4a+BNGVGJ6POBuLcKMh1G/i9wxYhQgH7bu+vZPAs8CsJGfNCcSAEz7TBKfse36xac4vzFi+LgD6o4/f2kCbdqE0QwmsLpfXuK0io8Y7MmjbXK05cP3401wmxytftYyPmsZ7Yhx4tMpv/79ry1aq7QIY3aLthnSvRwW426aW0f612MPg2CsYEzaVghDht1up/8gzu12e9uE/X6v2gGCTMbcnS8vOmWYAYbw3KnMAx7DCuOfATsbFkAMg8JIFQqFxP14fJKaF7vhE+8f2kfCwAHBiAHC3WRBZxvSrWWY8PlioUkCGMD7tcCMOYXIJc++SpBwh6/fFMg+EFQGCCasgQ0Ds48HYGhMLuC85Y0CzucLDfKQKgBBnSDrBAvWAdFt5+y/i4ZoxwqFw2G1dwCxE6FPJEQ+AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
    ></span>
    <img
        class="gatsby-resp-image-image"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;"
        alt="Running Cuckoo"
        title=""
        src="/blog/static/b0c184f694330c10af6d35ceadf9c996/fb8a0/cuckoo.png"
        srcset="/blog/static/b0c184f694330c10af6d35ceadf9c996/1a291/cuckoo.png 148w,
/blog/static/b0c184f694330c10af6d35ceadf9c996/2bc4a/cuckoo.png 295w,
/blog/static/b0c184f694330c10af6d35ceadf9c996/fb8a0/cuckoo.png 590w,
/blog/static/b0c184f694330c10af6d35ceadf9c996/5d9c9/cuckoo.png 650w"
        sizes="(max-width: 590px) 100vw, 590px"
      />
  </span>
  </a></p>
<p>Cuckoo outputs a series of csv files in the /logs folder that detail everything the malware did. I start here reading the logs since I see the processes happened from “bad” (which is what it’s configured to run on):</p>
<p><a
    class="gatsby-resp-image-link"
    href="/blog/static/f521780945e3f6e10bae330aa5f563de/870c1/doc1.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 69.98031496062993%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsSAAALEgHS3X78AAAB/0lEQVQ4y51SO2/UQBD2vwfE8VRCBIgCikABERFFaAKIDlHRpkvO3rXXj10/7nzoTvqYb7w5XASKFKO1Z3e+x8wkX86/4vTjKd6ffMKbtydYPH2JRwevsHjyQuI57iwOcO/hMzkPcffBYfw/0pO5+4+P8Pr4A76df8evz2dIjn84vPtZ4dI2WA09vPdYrVZYr9fYbDbYbrf6PY4j+mGQNyuM6xG73Q5d16HvB3n3G00IqCSSiyuLi0uLqvbwwcO5Qr5rNE2D5fIKxmTI8xx1U8NYg7IsJb9EJnnGMk2VaBTS0uVIijyDyw28AFCdc06Kp+9UHmdZqrnGN8gLAa6rPZi1Vkis3Hl0fSdkDgkvjDGq6GbADMWNgEYBGam8qaoKZVUiMbcBzGYKpdZL7waxzXYl1pKJgF4v2COCB+knC0noJOf3gLWCqELpLS1THQHVciGoVBVCi7ZrtSC0rUywRVEUyspcKzlaCmFywTuSa38bbsagQhImGCy4BmwVsMNENk2dOSrZA0qU7JuA8uR7ukhog2sRxC6DRZPlEC2bv0BiSS1Li67reE+1BIxDMXEo0x6WamHqYSorwx4W/1ubOG0OUQFtbmMiKuRQ5HKuUIciBGxBExecw6BC1hK8EiLGTOHt1ibTHYxD45SVbW65jIAzy+5fi51bPQmmeyi1fwDRbAfI79mkeAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    ></span>
    <img
        class="gatsby-resp-image-image"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;"
        alt="Log 1"
        title=""
        src="/blog/static/f521780945e3f6e10bae330aa5f563de/fb8a0/doc1.png"
        srcset="/blog/static/f521780945e3f6e10bae330aa5f563de/1a291/doc1.png 148w,
/blog/static/f521780945e3f6e10bae330aa5f563de/2bc4a/doc1.png 295w,
/blog/static/f521780945e3f6e10bae330aa5f563de/fb8a0/doc1.png 590w,
/blog/static/f521780945e3f6e10bae330aa5f563de/526de/doc1.png 885w,
/blog/static/f521780945e3f6e10bae330aa5f563de/870c1/doc1.png 1016w"
        sizes="(max-width: 590px) 100vw, 590px"
      />
  </span>
  </a>
<a
    class="gatsby-resp-image-link"
    href="/blog/static/4dd2151ced827126ce79414658b99484/d5f08/doc2.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 66.69902912621359%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACBklEQVQ4y4WSW2vUUBSF8///gLZqpXhD8EnECwNSC/pQ6IOF0okzFTQzk9tJMpPbJHNb7rWTE6UUDGzOScj+zlp7Hefi8gqfv3zDu/cjfBqd4fWbt3hwfIpHT1/i4eNnOHryXPdHdn/yAseyDiXvJ6ev8GF0jouzczg/b2+RmRCJiRFGMbLlEmVZIssyFEWB1WqFpVRVVvpeFCXqupZao2la2Ge73SGXf5zv1zf46kb45ceIogBxYmAEPpt7yAnMBSiHVFUp4KUeVFUVqrrqwOu1wLbY7XbYbjYEuvh4FWLihYjjsAcaAc6QZimCMMB8MVfoWpoJoQOq5VqKKgts2xbOD3eMVRIiFdDC9xGLOmMSeDNP7RNOVfz5cDgMxcfuCVOFAnbG47GoiLRx4S96oBHgb7Gbq8okSdQmVeXyTecqh3HlO0H7/V4ObeBMJhOBdDb9wIfpLdMm59eF0gXFJiriel9RpTOdTkUh5xcrMBFgJHt+I8yXMYSyj6JQlfIwHtA0jQRSo5FRWKAqdMWyHwTSEN2x7HWW01QOiNQuA6H1kin3xaC6Ge67UDhDwth4NxQq5HeGoor0/v1N2c7UznDDa+O6HTAeQjFqn3s2E8YmVabXpFS4nZmtAUiF3WwShZgeyFDYSEssXmRrs2n/Awz/CcXOkKoHW0WuEM4ul+TZeC9QZvgH6lDQFIQ8fBsAAAAASUVORK5CYII='); background-size: cover; display: block;"
    ></span>
    <img
        class="gatsby-resp-image-image"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;"
        alt="Log 2"
        title=""
        src="/blog/static/4dd2151ced827126ce79414658b99484/fb8a0/doc2.png"
        srcset="/blog/static/4dd2151ced827126ce79414658b99484/1a291/doc2.png 148w,
/blog/static/4dd2151ced827126ce79414658b99484/2bc4a/doc2.png 295w,
/blog/static/4dd2151ced827126ce79414658b99484/fb8a0/doc2.png 590w,
/blog/static/4dd2151ced827126ce79414658b99484/526de/doc2.png 885w,
/blog/static/4dd2151ced827126ce79414658b99484/d5f08/doc2.png 1030w"
        sizes="(max-width: 590px) 100vw, 590px"
      />
  </span>
  </a></p>
<p>It looks like the malware tries to find out information about a <code class="language-text">prints.exe</code> file (NtQueryDirectory) as well open the file and another file <code class="language-text">ntshruis2.dll</code> from <code class="language-text">C:\Users\Admin\AppData\Local\Temp\</code>. It also creates a registry key in the Session Manager and tries to open various registry keys. It later successfully creates the <code class="language-text">prints.exe</code> and <code class="language-text">ntshruis2.dll</code> files, as well as a <code class="language-text">Deleteme.bat</code> file in <code class="language-text">C:\Users\Admin\AppData\Local\Temp\</code>.</p>
<p>Looking at the strings, I also see it looking for a user <code class="language-text">SOFTWARE\Borland\Delphi\RTL</code>.</p>
<p>Knowing about the files it creates and where they are stored, I open up the Temp directory before running the malware:</p>
<p><a
    class="gatsby-resp-image-link"
    href="/blog/static/e771ebf34808e495ce8e831561ceeaa3/b7a32/created.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 34.18803418803419%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAABoklEQVQoz2VQPU8VQRTd/4IR/ACMhGdhbGxorPgFFlT0FBb22hliYUlrYmnkKwg8Aw+I8hKIhcbney8+WHdnv2Zndmbf7izHO+NH4yQn99yce8+5GW/tzQZWnjzFwqNF3Gk9wOT0PK7fnsPUzDyh9R+u3ZrDxM27uDF7D637D/F4aRmrL1/h9eoLrD1/Bq/bj3HwqYv13WOsv+9gq32Ct9sfHN/cO8K7nUPsHJyifXLmsLH/kWaPsNfpUn+O/eNz2v+M9ukXbHbO4A1/BAiSAhHXuGQ5wrRAIsYIqKZU//ZW9yOBVFaut8i1QZgpRDlpTODrIIT3vd9HmsSwT6sUgT+CFML1V435h0IKxHGMPOcoCgkhctTVGKau0ZjfiHgB79L3cTG6gNYaUmkM+gP0vvUQhgxSFjDGoK4NGQiEjCHLMuISjHiSpKjI0O3SLJcaXhIzSs3dkiJhSIY2oCxLVOPKGTYEzjP4FG6v5GQa/AxciDENaRycPBh9i9cbjsCC0AmlVkiiiAZyNE3z57raVaWUC7aXWG7NrGbnylK7Y4JU4RfBwufRhGXrcwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    ></span>
    <img
        class="gatsby-resp-image-image"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;"
        alt="Created files"
        title=""
        src="/blog/static/e771ebf34808e495ce8e831561ceeaa3/fb8a0/created.png"
        srcset="/blog/static/e771ebf34808e495ce8e831561ceeaa3/1a291/created.png 148w,
/blog/static/e771ebf34808e495ce8e831561ceeaa3/2bc4a/created.png 295w,
/blog/static/e771ebf34808e495ce8e831561ceeaa3/fb8a0/created.png 590w,
/blog/static/e771ebf34808e495ce8e831561ceeaa3/b7a32/created.png 819w"
        sizes="(max-width: 590px) 100vw, 590px"
      />
  </span>
  </a></p>
<p>I also see a file called <code class="language-text">qinput.png</code> which I translate using my phone. It looks like a login screen:</p>
<p><a
    class="gatsby-resp-image-link"
    href="/blog/static/4ff17cc80b1f9a314475eb16738ab8bc/e3ca9/created2.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 70.68004459308807%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsSAAALEgHS3X78AAACYElEQVQ4y42Sy27TQBSG8zDseQGegSULWHSHCgKhUipxkVAEqFWXILJCSBULtl0gSpUipaoUpYhWapIW4iap6zh27MSOx/fcf844CXFSFiw+zZkzM7+Pz38SmcMCTgQZuaKEg7yE/YKMdEHHTr6JnRMdu8UWdgsz0mcG0qdj9ijeFywclg3k8wL2tr8iUa0b0FgHqhmMaQdomD5Uw0OThWjZnYimzePZPp7XrBBmCByV6kiYThdO0IftE8EMRvu214uwvP4c/CyORXf87giVSwUJXsU0GccJBgh7QNgdIgj78GPYC/fbbhdeFxAuqEKNfpFXxA+YP77ghgMIqoXtbJF6WUNGdHEgecjKPrI1D3V640zeWD4X7EWCv6skWK1pcDujOUFendh08CVXwPd8BUcyww/RwE/JxLFsQbWCWZW8NVShT4K/uOC5qFwR5C0w3Q4000KtoaPRaqOmapApVptmdDa9z+KCFRmJ8uVVQf51zfKgGAzUQoSDUbR2CDqK3GbcIG7KxDj+y6ULMqUs/ltQaXuo6DZUFkBhPmTTofHyKe9Cp9xfI/3/FvQhaIywcUYGHYs6SooJod6aE2SLgtxqJxyBz2N8FNhk3uwpZFR87hbHhto6FpTUFjV0SIk+ucur60Ywb0a0X8zFYovUuEapSqZ8y+SoTyOUzm1IWg+KPYRqA5oLNBxA90BjQjk2jGKeX6RBGFRhkUYrce36Ddy+n8TNW6u4s/wKSyvrePAyhbXNLTzd/Ii1Nyk8Wv+MlY1PePI6hdWNLTxb/4DHyfe4+/wtlol7L95F69LDJP4A/x0HA7PL3voAAAAASUVORK5CYII='); background-size: cover; display: block;"
    ></span>
    <img
        class="gatsby-resp-image-image"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;"
        alt="Created image file qinput.png"
        title=""
        src="/blog/static/4ff17cc80b1f9a314475eb16738ab8bc/fb8a0/created2.png"
        srcset="/blog/static/4ff17cc80b1f9a314475eb16738ab8bc/1a291/created2.png 148w,
/blog/static/4ff17cc80b1f9a314475eb16738ab8bc/2bc4a/created2.png 295w,
/blog/static/4ff17cc80b1f9a314475eb16738ab8bc/fb8a0/created2.png 590w,
/blog/static/4ff17cc80b1f9a314475eb16738ab8bc/526de/created2.png 885w,
/blog/static/4ff17cc80b1f9a314475eb16738ab8bc/e3ca9/created2.png 897w"
        sizes="(max-width: 590px) 100vw, 590px"
      />
  </span>
  </a></p>
<p>Translation:</p>
<div class="gatsby-highlight" data-language="re-register"><pre class="language-re-register"><code class="language-re-register">Dear User:
Since your network is unstable, please login:
[input]
Password:
[input]
[Login] [Cancellation]</code></pre></div>
<p>Looking at the <code class="language-text">Deleteme.bat</code> file, it seems to do exactly what it’s named, delete the source of the malware:</p>
<p><a
    class="gatsby-resp-image-link"
    href="/blog/static/fee8c8abdd33d05bfa0c9ab9554ba1a9/cf471/created3.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 26.773888363292336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsSAAALEgHS3X78AAABTklEQVQY03WP3StDARyGzz9GQpqvaMTccOOjSG4myYU/QPKRK3GhcIPSppaxDdvZztlpOzqO2c5m5+xYRORurbb1OLiUXz09N+/71k/YWlrm4NjH2Pg0k3MLeJdXGJ+dx+0ZpdXVS0//EH2DI/S6h2np6KaptZPm9i6a2hw7uAY8THgXWd3YZGFmCuH2LoPxoKCmUiSSOnJKQ1Vvyeg6ecPALD5SLj/x8vJMybbRswUyRpFMzsG0ub+Ik17fJ719wtH6LkIsIfGNKCcdy86oguRwE4sRjkSQZJnzYBD/mZ9Tnw9/IMBVTCR8EyXkZEL+AJc7h1zvH7O3toWQz+bIF4oUTQvTsnl9e+f94xOrZJNWVSyr9ONoNIooiiTicRKShKIoaJqGdq+jGVkKTyWC4RAC/1y1WnVeLVOpVGg0Gj/UajXqtfqv6/U/Hcs0+QLcX0QEn39BogAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    ></span>
    <img
        class="gatsby-resp-image-image"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;"
        alt="Deleteme.bat"
        title=""
        src="/blog/static/fee8c8abdd33d05bfa0c9ab9554ba1a9/fb8a0/created3.png"
        srcset="/blog/static/fee8c8abdd33d05bfa0c9ab9554ba1a9/1a291/created3.png 148w,
/blog/static/fee8c8abdd33d05bfa0c9ab9554ba1a9/2bc4a/created3.png 295w,
/blog/static/fee8c8abdd33d05bfa0c9ab9554ba1a9/fb8a0/created3.png 590w,
/blog/static/fee8c8abdd33d05bfa0c9ab9554ba1a9/526de/created3.png 885w,
/blog/static/fee8c8abdd33d05bfa0c9ab9554ba1a9/cf471/created3.png 1057w"
        sizes="(max-width: 590px) 100vw, 590px"
      />
  </span>
  </a></p>
<p>Finally, the malware tries to download one file, <code class="language-text">TJ.asp</code>:
<a
    class="gatsby-resp-image-link"
    href="/blog/static/23ae0c646c8890afe7da4d3d5b50c14c/32413/network.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 583px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 56.089193825042884%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAACDklEQVQoz42SS2sTYRSGJzEJuZPQ3Cb3+3UumSRNJiYL9xJsaiRpa0GCqJWKRdA/4M6ley12odlYkFYdNzUQaSlqwYJ/QH/I63wHKy5a2sXLOXNmvvc853zDffpyBE2bQvs4xcH+MWafv0Gb/sDrvWN8OPqF7dlPvNrZh/b1Nybad0zeHWDyZg8vXu5ic/M9trY0bL+dYXfnUPc4BPf02XMsLCxiOFzBYDBCr9dHf7CE3mAZV/tD9K6PsDq+i8HyLTQvX4Egz0MQaqhUFBLLlWqLJEkNcPfWN5BKJiCIArLZLJLJJGRJ1GtxZDNp8MEA/L45uF0OcBx3vh4+eoJ0KgVZllEsFlEqlfTOFUj6cy6XQ0Zvks/nkU6n4fcHYDQaYTAYdBlPFbcyXkM0wiOeSCAejyMcDlP0eDxwu90U7XY7mVyI8M6Dx1Bb82i1VNTrdSJlSunUoVBIp/LD6XTCarXCZDKdb3jz9jr4UIAMYrEYGUSj0X+kLLJ6JBIBz/MIBoP0jc/nowlYZDWH4++Or91YhemSEV6vFzabjV6w3OVyERGrmc1mIrzQyOO1DdSUKrrdLtrtNlRVRafTQbVaJTJGzm6fkfy/xzN32lscoVIuQdYNBEFArVZDs9kkQ5YrioJGo4FyuUzKZDLUhE1w+g7H9xGLRiCKIv0uhUKBDkqSRLdrsVhIJ+Of5GeN/AdK40dTGlNvXQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    ></span>
    <img
        class="gatsby-resp-image-image"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;"
        alt="Tries to download a file"
        title=""
        src="/blog/static/23ae0c646c8890afe7da4d3d5b50c14c/32413/network.png"
        srcset="/blog/static/23ae0c646c8890afe7da4d3d5b50c14c/a734f/network.png 148w,
/blog/static/23ae0c646c8890afe7da4d3d5b50c14c/5c6ba/network.png 295w,
/blog/static/23ae0c646c8890afe7da4d3d5b50c14c/32413/network.png 583w"
        sizes="(max-width: 583px) 100vw, 583px"
      />
  </span>
  </a></p></div><hr/><p style="text-transform:uppercase;font-size:14px"><a href="/blog/tags/school/">school<!-- --> </a><a href="/blog/tags/security/">security<!-- --> </a></p><div style="display:flex"><p>By<!-- --> <strong>Michele Larson</strong></p></div><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/blog/security-forensics/">← <!-- -->Thoughts on Forensics (Defense of the Dark Arts)</a></li><li><a rel="next" href="/blog/security-software/">Thoughts on Software Vulnerabilities (Defense Against the Dark Arts)<!-- --> →</a></li></ul></div></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'undefined', 'auto', {});
      
      
      
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-blog-post-js","jsonName":"security-defenses-2a7","path":"/security-defenses/"};window.dataPath="613/path---security-defenses-2-a-7-855-8g8wK9S8MKmIIZQF1aZG702t6P0";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-f66cd48d3b7ffec6f559.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-3243d24a58c1ec451366.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js.72dbeacc3950e5605200.css","/component---src-templates-blog-post-js-874a1cf32e0f30fb274d.js"],"component---src-templates-tags-js":["/component---src-templates-tags-js.72dbeacc3950e5605200.css","/component---src-templates-tags-js-5b990690a4223c7572f3.js"],"component---src-pages-404-js":["/component---src-pages-404-js.72dbeacc3950e5605200.css","/component---src-pages-404-js-83b4f47cd9f059860b3f.js"],"component---src-pages-index-js":["/component---src-pages-index-js.72dbeacc3950e5605200.css","/component---src-pages-index-js-34532f2676402adfb57f.js"],"component---src-pages-tags-js":["/component---src-pages-tags-js.72dbeacc3950e5605200.css","/component---src-pages-tags-js-0b7c6d04ebae9fd1832d.js"],"pages-manifest":["/pages-manifest-d9b7ae7f24b0324e9587.js"]};/*]]>*/</script><script src="/blog/component---src-templates-blog-post-js-874a1cf32e0f30fb274d.js" async=""></script><script src="/blog/0-d5b0ae4c4b22ae57f84e.js" async=""></script><script src="/blog/app-f66cd48d3b7ffec6f559.js" async=""></script><script src="/blog/webpack-runtime-ec626fa5275f79d2758b.js" async=""></script></body></html>